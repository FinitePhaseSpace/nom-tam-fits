<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2016-06-05
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20160605" />
    <meta http-equiv="Content-Language" content="en" />
    <title>nom-tam-fits &#x2013; Compression support</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/nom-tam-fits/nom-tam-fits">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                                                                                                <img src="images/fits_logo.png" />
                </div>
                      </div>
        <div class="pull-right">              <div id="bannerRight">
                                                                                                <img src="images/fits_logo_text.png" />
                </div>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2016-06-05</li>
                          <li class="divider">|</li>             <li class="">
                    <a href="index.html" title="nom.tam FITS library">
        nom.tam FITS library</a>
        </li>
      <li class="divider ">/</li>
        <li class="">Compression support</li>
                
                
                    
                 <li id="projectVersion" class="pull-right">Version: 1.14.3</li>
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Documentation</li>
                                
      <li>
    
                          <a href="index.html" title="About">
          <i class="none"></i>
        About</a>
            </li>
                  
      <li>
    
                          <a href="intro.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                  
      <li>
    
                          <a href="header.html" title="Fits keywords">
          <i class="none"></i>
        Fits keywords</a>
            </li>
                  
      <li>
    
                          <a href="download.html" title="Download">
          <i class="none"></i>
        Download</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>Compression</a>
          </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                            
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                                                                                                                      
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                   <a href="http://maven.apache.org/" title="Maven" class="builtBy">
        <img class="builtBy"  alt="Maven" src="http://maven.apache.org/images/logos/maven-feather.png"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Compression support</h1>
<p>Image compression and tiling are now fully supported by nom-tam-fits. A 100% Java implementation of the compression libraries available in cfitsio was implemented. An API for easy handling of compressed images is now provided. Support for binary table compression and the NULL_PIXEL_MASK features is anticipated in the next release.</p>
<p>When [de]compressing all available CPU&#x2019;s are automatically utilized.</p>
<p>Internal compression allows FITS files to be created where the data are efficiently stored, but the metadata is still easily accessible. The tiling of images is particularly critical for supporting efficient access to subsets of very large images. A user can easily access only the tiles that overlap the region of interest and can skip data not of interest. While some skipping might be possible with uncompressed FITS files (i.e., read only the rows overlapping the desired subset), internal tiles can be much more efficient when the image is substantially larger than the subset. Most compression algorithms interfere with the ability to skip uninteresting data, but tiles are compressed independently, so users can benefit both from the compression and the selection of only a subset of the image.</p>
<p>To compress an existing image HDU, use code like:</p>

<div class="source">
<div class="source">
<pre>try (Fits f = new Fits()) {
    CompressedImageHDU compressedHdu = CompressedImageHDU.fromImageHDU(someImageHDU, 300, 15);
    compressedHdu
        .setCompressAlgorithm(Compression.ZCMPTYPE_HCOMPRESS_1)//
        .setQuantAlgorithm(Compression.ZQUANTIZ_SUBTRACTIVE_DITHER_2)//
        .getCompressOption(QuantizeOption.class)//
        /**/.setQlevel(1.0)//
        .getCompressOption(HCompressorOption.class)//
        /**/.setScale(1);
    compressedHdu.compress();
    f.addHDU(compressedHdu);
    try (BufferedDataOutputStream bdos = new BufferedDataOutputStream(new FileOutputStream(&quot;something.fits.fz&quot;))) {
        f.write(bdos);
    }
} 
</pre></div></div>
<p>Depending on the compression algorithm you select, different options can be set, and if you activate quantization (as in the example above) another set of options is available.</p>

<table border="0" class="table table-striped">
	
<tr class="a">
		
<td>quant?</td>
		
<td><b>Compression</b></td>
		
<td><b>option java classes</b></td>
	</tr>
	
<tr class="b">
		
<td>no</td>
		
<td>ZCMPTYPE_GZIP_1</td>
		
<td>no options </td>
	</tr>
	
<tr class="a">
		
<td>no</td>
		
<td>ZCMPTYPE_GZIP_2</td>
		
<td>no options </td>
	</tr>
	
<tr class="b">
		
<td>no</td>
		
<td>ZCMPTYPE_RICE_ONE/ZCMPTYPE_RICE_1</td>
		
<td>RiceCompressOption </td>
	</tr>
	
<tr class="a">
		
<td>no</td>
		
<td>ZCMPTYPE_PLIO_1</td>
		
<td>no options </td>
	</tr>
	
<tr class="b">
		
<td>no</td>
		
<td>ZCMPTYPE_HCOMPRESS_1</td>
		
<td>HCompressorOption </td>
	</tr>
	
<tr class="a">
		
<td>yes</td>
		
<td>ZCMPTYPE_GZIP_1</td>
		
<td>QuantizeOption </td>
	</tr>
	
<tr class="b">
		
<td>yes</td>
		
<td>ZCMPTYPE_GZIP_2</td>
		
<td>QuantizeOption </td>
	</tr>
	
<tr class="a">
		
<td>yes</td>
		
<td>ZCMPTYPE_RICE_ONE/ZCMPTYPE_RICE_1</td>
		
<td>RiceCompressOption,QuantizeOption </td>
	</tr>
	
<tr class="b">
		
<td>yes</td>
		
<td>ZCMPTYPE_PLIO_1</td>
		
<td>QuantizeOption </td>
	</tr>
	
<tr class="a">
		
<td>yes</td>
		
<td>ZCMPTYPE_HCOMPRESS_1</td>
		
<td>HCompressorOption,QuantizeOption </td>
	</tr>
</table>
<p>All information required for image decompression are stored in the header of the image file. Therefore no options need to be provided to decompress a file:</p>

<div class="source">
<div class="source">
<pre>    try (Fits f = new Fits(&quot;something.fits.fz&quot;)) {
        f.readHDU();
        CompressedImageHDU hdu = (CompressedImageHDU) f.readHDU();
        ImageHdu uncompressedImage = hdu.asImageHDU();
    }
</pre></div></div>
<p>Please read the original fits documentation for further information on the different compression options and their possible values.</p>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    1996-2016
                      nom-tam-fits.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
