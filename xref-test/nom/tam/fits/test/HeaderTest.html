<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>HeaderTest xref</title>
<link type="text/css" rel="stylesheet" href="../../../../stylesheet.css" />
</head>
<body>
<div id="overview"><a href="../../../../../testapidocs/nom/tam/fits/test/HeaderTest.html">View Javadoc</a></div><pre>
<a class="jxr_linenumber" name="L1" href="#L1">1</a>   <strong class="jxr_keyword">package</strong> nom.tam.fits.test;
<a class="jxr_linenumber" name="L2" href="#L2">2</a>   
<a class="jxr_linenumber" name="L3" href="#L3">3</a>   <em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="L4" href="#L4">4</a>   <em class="jxr_comment"> * #%L</em>
<a class="jxr_linenumber" name="L5" href="#L5">5</a>   <em class="jxr_comment"> * nom.tam FITS library</em>
<a class="jxr_linenumber" name="L6" href="#L6">6</a>   <em class="jxr_comment"> * %%</em>
<a class="jxr_linenumber" name="L7" href="#L7">7</a>   <em class="jxr_comment"> * Copyright (C) 2004 - 2015 nom-tam-fits</em>
<a class="jxr_linenumber" name="L8" href="#L8">8</a>   <em class="jxr_comment"> * %%</em>
<a class="jxr_linenumber" name="L9" href="#L9">9</a>   <em class="jxr_comment"> * This is free and unencumbered software released into the public domain.</em>
<a class="jxr_linenumber" name="L10" href="#L10">10</a>  <em class="jxr_comment"> * </em>
<a class="jxr_linenumber" name="L11" href="#L11">11</a>  <em class="jxr_comment"> * Anyone is free to copy, modify, publish, use, compile, sell, or</em>
<a class="jxr_linenumber" name="L12" href="#L12">12</a>  <em class="jxr_comment"> * distribute this software, either in source code form or as a compiled</em>
<a class="jxr_linenumber" name="L13" href="#L13">13</a>  <em class="jxr_comment"> * binary, for any purpose, commercial or non-commercial, and by any</em>
<a class="jxr_linenumber" name="L14" href="#L14">14</a>  <em class="jxr_comment"> * means.</em>
<a class="jxr_linenumber" name="L15" href="#L15">15</a>  <em class="jxr_comment"> * </em>
<a class="jxr_linenumber" name="L16" href="#L16">16</a>  <em class="jxr_comment"> * In jurisdictions that recognize copyright laws, the author or authors</em>
<a class="jxr_linenumber" name="L17" href="#L17">17</a>  <em class="jxr_comment"> * of this software dedicate any and all copyright interest in the</em>
<a class="jxr_linenumber" name="L18" href="#L18">18</a>  <em class="jxr_comment"> * software to the public domain. We make this dedication for the benefit</em>
<a class="jxr_linenumber" name="L19" href="#L19">19</a>  <em class="jxr_comment"> * of the public at large and to the detriment of our heirs and</em>
<a class="jxr_linenumber" name="L20" href="#L20">20</a>  <em class="jxr_comment"> * successors. We intend this dedication to be an overt act of</em>
<a class="jxr_linenumber" name="L21" href="#L21">21</a>  <em class="jxr_comment"> * relinquishment in perpetuity of all present and future rights to this</em>
<a class="jxr_linenumber" name="L22" href="#L22">22</a>  <em class="jxr_comment"> * software under copyright law.</em>
<a class="jxr_linenumber" name="L23" href="#L23">23</a>  <em class="jxr_comment"> * </em>
<a class="jxr_linenumber" name="L24" href="#L24">24</a>  <em class="jxr_comment"> * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,</em>
<a class="jxr_linenumber" name="L25" href="#L25">25</a>  <em class="jxr_comment"> * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</em>
<a class="jxr_linenumber" name="L26" href="#L26">26</a>  <em class="jxr_comment"> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.</em>
<a class="jxr_linenumber" name="L27" href="#L27">27</a>  <em class="jxr_comment"> * IN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR</em>
<a class="jxr_linenumber" name="L28" href="#L28">28</a>  <em class="jxr_comment"> * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,</em>
<a class="jxr_linenumber" name="L29" href="#L29">29</a>  <em class="jxr_comment"> * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR</em>
<a class="jxr_linenumber" name="L30" href="#L30">30</a>  <em class="jxr_comment"> * OTHER DEALINGS IN THE SOFTWARE.</em>
<a class="jxr_linenumber" name="L31" href="#L31">31</a>  <em class="jxr_comment"> * #L%</em>
<a class="jxr_linenumber" name="L32" href="#L32">32</a>  <em class="jxr_comment"> */</em>
<a class="jxr_linenumber" name="L33" href="#L33">33</a>  
<a class="jxr_linenumber" name="L34" href="#L34">34</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> nom.tam.fits.header.Standard.BITPIX;
<a class="jxr_linenumber" name="L35" href="#L35">35</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> nom.tam.fits.header.Standard.END;
<a class="jxr_linenumber" name="L36" href="#L36">36</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> nom.tam.fits.header.Standard.EXTEND;
<a class="jxr_linenumber" name="L37" href="#L37">37</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> nom.tam.fits.header.Standard.NAXIS;
<a class="jxr_linenumber" name="L38" href="#L38">38</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> nom.tam.fits.header.Standard.NAXISn;
<a class="jxr_linenumber" name="L39" href="#L39">39</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> nom.tam.fits.header.Standard.SIMPLE;
<a class="jxr_linenumber" name="L40" href="#L40">40</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> nom.tam.fits.header.Standard.XTENSION;
<a class="jxr_linenumber" name="L41" href="#L41">41</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> nom.tam.fits.header.Standard.XTENSION_BINTABLE;
<a class="jxr_linenumber" name="L42" href="#L42">42</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> nom.tam.fits.header.extra.NOAOExt.CRPIX1;
<a class="jxr_linenumber" name="L43" href="#L43">43</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> nom.tam.fits.header.extra.NOAOExt.CRPIX2;
<a class="jxr_linenumber" name="L44" href="#L44">44</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> nom.tam.fits.header.extra.NOAOExt.CRVAL1;
<a class="jxr_linenumber" name="L45" href="#L45">45</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> nom.tam.fits.header.extra.NOAOExt.CRVAL2;
<a class="jxr_linenumber" name="L46" href="#L46">46</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> nom.tam.fits.header.extra.NOAOExt.CTYPE1;
<a class="jxr_linenumber" name="L47" href="#L47">47</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> nom.tam.fits.header.extra.NOAOExt.CTYPE2;
<a class="jxr_linenumber" name="L48" href="#L48">48</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> org.junit.Assert.assertEquals;
<a class="jxr_linenumber" name="L49" href="#L49">49</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> org.junit.Assert.assertFalse;
<a class="jxr_linenumber" name="L50" href="#L50">50</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> org.junit.Assert.assertNotNull;
<a class="jxr_linenumber" name="L51" href="#L51">51</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> org.junit.Assert.assertNull;
<a class="jxr_linenumber" name="L52" href="#L52">52</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> org.junit.Assert.assertTrue;
<a class="jxr_linenumber" name="L53" href="#L53">53</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> org.junit.Assert.fail;
<a class="jxr_linenumber" name="L54" href="#L54">54</a>  
<a class="jxr_linenumber" name="L55" href="#L55">55</a>  <strong class="jxr_keyword">import</strong> java.io.ByteArrayInputStream;
<a class="jxr_linenumber" name="L56" href="#L56">56</a>  <strong class="jxr_keyword">import</strong> java.io.ByteArrayOutputStream;
<a class="jxr_linenumber" name="L57" href="#L57">57</a>  <strong class="jxr_keyword">import</strong> java.io.File;
<a class="jxr_linenumber" name="L58" href="#L58">58</a>  <strong class="jxr_keyword">import</strong> java.io.FileInputStream;
<a class="jxr_linenumber" name="L59" href="#L59">59</a>  <strong class="jxr_keyword">import</strong> java.io.FileOutputStream;
<a class="jxr_linenumber" name="L60" href="#L60">60</a>  <strong class="jxr_keyword">import</strong> java.io.IOException;
<a class="jxr_linenumber" name="L61" href="#L61">61</a>  <strong class="jxr_keyword">import</strong> java.io.PrintStream;
<a class="jxr_linenumber" name="L62" href="#L62">62</a>  <strong class="jxr_keyword">import</strong> java.math.BigDecimal;
<a class="jxr_linenumber" name="L63" href="#L63">63</a>  <strong class="jxr_keyword">import</strong> java.math.BigInteger;
<a class="jxr_linenumber" name="L64" href="#L64">64</a>  <strong class="jxr_keyword">import</strong> java.util.Arrays;
<a class="jxr_linenumber" name="L65" href="#L65">65</a>  
<a class="jxr_linenumber" name="L66" href="#L66">66</a>  <strong class="jxr_keyword">import</strong> org.junit.After;
<a class="jxr_linenumber" name="L67" href="#L67">67</a>  <strong class="jxr_keyword">import</strong> org.junit.Assert;
<a class="jxr_linenumber" name="L68" href="#L68">68</a>  <strong class="jxr_keyword">import</strong> org.junit.Before;
<a class="jxr_linenumber" name="L69" href="#L69">69</a>  <strong class="jxr_keyword">import</strong> org.junit.Test;
<a class="jxr_linenumber" name="L70" href="#L70">70</a>  
<a class="jxr_linenumber" name="L71" href="#L71">71</a>  <strong class="jxr_keyword">import</strong> nom.tam.fits.BasicHDU;
<a class="jxr_linenumber" name="L72" href="#L72">72</a>  <strong class="jxr_keyword">import</strong> nom.tam.fits.Fits;
<a class="jxr_linenumber" name="L73" href="#L73">73</a>  <strong class="jxr_keyword">import</strong> nom.tam.fits.FitsException;
<a class="jxr_linenumber" name="L74" href="#L74">74</a>  <strong class="jxr_keyword">import</strong> nom.tam.fits.FitsFactory;
<a class="jxr_linenumber" name="L75" href="#L75">75</a>  <strong class="jxr_keyword">import</strong> nom.tam.fits.Header;
<a class="jxr_linenumber" name="L76" href="#L76">76</a>  <strong class="jxr_keyword">import</strong> nom.tam.fits.HeaderCard;
<a class="jxr_linenumber" name="L77" href="#L77">77</a>  <strong class="jxr_keyword">import</strong> nom.tam.fits.HeaderCardException;
<a class="jxr_linenumber" name="L78" href="#L78">78</a>  <strong class="jxr_keyword">import</strong> nom.tam.fits.HeaderCommentsMap;
<a class="jxr_linenumber" name="L79" href="#L79">79</a>  <strong class="jxr_keyword">import</strong> nom.tam.fits.HeaderOrder;
<a class="jxr_linenumber" name="L80" href="#L80">80</a>  <strong class="jxr_keyword">import</strong> nom.tam.fits.ImageHDU;
<a class="jxr_linenumber" name="L81" href="#L81">81</a>  <strong class="jxr_keyword">import</strong> nom.tam.fits.TruncatedFileException;
<a class="jxr_linenumber" name="L82" href="#L82">82</a>  <strong class="jxr_keyword">import</strong> nom.tam.fits.header.Standard;
<a class="jxr_linenumber" name="L83" href="#L83">83</a>  <strong class="jxr_keyword">import</strong> nom.tam.fits.utilities.FitsHeaderCardParser;
<a class="jxr_linenumber" name="L84" href="#L84">84</a>  <strong class="jxr_keyword">import</strong> nom.tam.fits.utilities.FitsHeaderCardParser.ParsedValue;
<a class="jxr_linenumber" name="L85" href="#L85">85</a>  <strong class="jxr_keyword">import</strong> nom.tam.util.ArrayDataOutput;
<a class="jxr_linenumber" name="L86" href="#L86">86</a>  <strong class="jxr_keyword">import</strong> nom.tam.util.AsciiFuncs;
<a class="jxr_linenumber" name="L87" href="#L87">87</a>  <strong class="jxr_keyword">import</strong> nom.tam.util.BufferedDataInputStream;
<a class="jxr_linenumber" name="L88" href="#L88">88</a>  <strong class="jxr_keyword">import</strong> nom.tam.util.BufferedDataOutputStream;
<a class="jxr_linenumber" name="L89" href="#L89">89</a>  <strong class="jxr_keyword">import</strong> nom.tam.util.BufferedFile;
<a class="jxr_linenumber" name="L90" href="#L90">90</a>  <strong class="jxr_keyword">import</strong> nom.tam.util.Cursor;
<a class="jxr_linenumber" name="L91" href="#L91">91</a>  <strong class="jxr_keyword">import</strong> nom.tam.util.SafeClose;
<a class="jxr_linenumber" name="L92" href="#L92">92</a>  <strong class="jxr_keyword">import</strong> nom.tam.util.test.ThrowAnyException;
<a class="jxr_linenumber" name="L93" href="#L93">93</a>  
<a class="jxr_linenumber" name="L94" href="#L94">94</a>  <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">class</strong> <a href="../../../../nom/tam/fits/test/HeaderTest.html">HeaderTest</a> {
<a class="jxr_linenumber" name="L95" href="#L95">95</a>  
<a class="jxr_linenumber" name="L96" href="#L96">96</a>      <strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">boolean</strong> longStringsEnabled;
<a class="jxr_linenumber" name="L97" href="#L97">97</a>  
<a class="jxr_linenumber" name="L98" href="#L98">98</a>      <strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">boolean</strong> useHierarch;
<a class="jxr_linenumber" name="L99" href="#L99">99</a>  
<a class="jxr_linenumber" name="L100" href="#L100">100</a>     @Before
<a class="jxr_linenumber" name="L101" href="#L101">101</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> before() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L102" href="#L102">102</a>         longStringsEnabled = FitsFactory.isLongStringsEnabled();
<a class="jxr_linenumber" name="L103" href="#L103">103</a>         useHierarch = FitsFactory.getUseHierarch();
<a class="jxr_linenumber" name="L104" href="#L104">104</a> 
<a class="jxr_linenumber" name="L105" href="#L105">105</a>         <strong class="jxr_keyword">float</strong>[][] img = <strong class="jxr_keyword">new</strong> <strong class="jxr_keyword">float</strong>[300][300];
<a class="jxr_linenumber" name="L106" href="#L106">106</a>         Fits f = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L107" href="#L107">107</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L108" href="#L108">108</a>             f = <strong class="jxr_keyword">new</strong> Fits();
<a class="jxr_linenumber" name="L109" href="#L109">109</a>             ImageHDU hdu = (ImageHDU) Fits.makeHDU(img);
<a class="jxr_linenumber" name="L110" href="#L110">110</a>             f.addHDU(hdu);
<a class="jxr_linenumber" name="L111" href="#L111">111</a>             f.write(<strong class="jxr_keyword">new</strong> File(<span class="jxr_string">"target/ht1.fits"</span>));
<a class="jxr_linenumber" name="L112" href="#L112">112</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L113" href="#L113">113</a>             SafeClose.close(f);
<a class="jxr_linenumber" name="L114" href="#L114">114</a>         }
<a class="jxr_linenumber" name="L115" href="#L115">115</a>     }
<a class="jxr_linenumber" name="L116" href="#L116">116</a> 
<a class="jxr_linenumber" name="L117" href="#L117">117</a>     @After
<a class="jxr_linenumber" name="L118" href="#L118">118</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> after() {
<a class="jxr_linenumber" name="L119" href="#L119">119</a>         FitsFactory.setLongStringsEnabled(longStringsEnabled);
<a class="jxr_linenumber" name="L120" href="#L120">120</a>         FitsFactory.setUseHierarch(useHierarch);
<a class="jxr_linenumber" name="L121" href="#L121">121</a>     }
<a class="jxr_linenumber" name="L122" href="#L122">122</a> 
<a class="jxr_linenumber" name="L123" href="#L123">123</a>     @Test
<a class="jxr_linenumber" name="L124" href="#L124">124</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> cursorTest() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L125" href="#L125">125</a> 
<a class="jxr_linenumber" name="L126" href="#L126">126</a>         Fits f = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L127" href="#L127">127</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L128" href="#L128">128</a>             f = <strong class="jxr_keyword">new</strong> Fits(<span class="jxr_string">"target/ht1.fits"</span>);
<a class="jxr_linenumber" name="L129" href="#L129">129</a>             ImageHDU hdu = (ImageHDU) f.getHDU(0);
<a class="jxr_linenumber" name="L130" href="#L130">130</a>             Header hdr = hdu.getHeader();
<a class="jxr_linenumber" name="L131" href="#L131">131</a>             Cursor&lt;String, HeaderCard&gt; c = hdr.iterator();
<a class="jxr_linenumber" name="L132" href="#L132">132</a> 
<a class="jxr_linenumber" name="L133" href="#L133">133</a>             c.setKey(<span class="jxr_string">"XXX"</span>);
<a class="jxr_linenumber" name="L134" href="#L134">134</a>             c.add(<strong class="jxr_keyword">new</strong> HeaderCard(CTYPE1.key(), <span class="jxr_string">"GLON-CAR"</span>, <span class="jxr_string">"Galactic Longitude"</span>));
<a class="jxr_linenumber" name="L135" href="#L135">135</a>             c.add(<strong class="jxr_keyword">new</strong> HeaderCard(CTYPE2.key(), <span class="jxr_string">"GLAT-CAR"</span>, <span class="jxr_string">"Galactic Latitude"</span>));
<a class="jxr_linenumber" name="L136" href="#L136">136</a>             c.setKey(CTYPE1.key()); <em class="jxr_comment">// Move before CTYPE1</em>
<a class="jxr_linenumber" name="L137" href="#L137">137</a>             c.add(<strong class="jxr_keyword">new</strong> HeaderCard(CRVAL1.key(), 0., <span class="jxr_string">"Longitude at reference"</span>));
<a class="jxr_linenumber" name="L138" href="#L138">138</a>             c.setKey(CTYPE2.key()); <em class="jxr_comment">// Move before CTYPE2</em>
<a class="jxr_linenumber" name="L139" href="#L139">139</a>             c.add(<strong class="jxr_keyword">new</strong> HeaderCard(CRVAL2.key(), -90., <span class="jxr_string">"Latitude at reference"</span>));
<a class="jxr_linenumber" name="L140" href="#L140">140</a>             c.setKey(CTYPE1.key()); <em class="jxr_comment">// Just practicing moving around!!</em>
<a class="jxr_linenumber" name="L141" href="#L141">141</a>             c.add(<strong class="jxr_keyword">new</strong> HeaderCard(CRPIX1.key(), 150.0, <span class="jxr_string">"Reference Pixel X"</span>));
<a class="jxr_linenumber" name="L142" href="#L142">142</a>             c.setKey(CTYPE2.key());
<a class="jxr_linenumber" name="L143" href="#L143">143</a>             c.add(<strong class="jxr_keyword">new</strong> HeaderCard(CRPIX2.key(), BigDecimal.valueOf(0.), <span class="jxr_string">"Reference pixel Y"</span>));
<a class="jxr_linenumber" name="L144" href="#L144">144</a>             c.add(<strong class="jxr_keyword">new</strong> HeaderCard(<span class="jxr_string">"INV2"</span>, <strong class="jxr_keyword">true</strong>, <span class="jxr_string">"Invertible axis"</span>));
<a class="jxr_linenumber" name="L145" href="#L145">145</a>             c.add(<strong class="jxr_keyword">new</strong> HeaderCard(<span class="jxr_string">"SYM2"</span>, <span class="jxr_string">"YZ SYMMETRIC"</span>, <span class="jxr_string">"Symmetries..."</span>));
<a class="jxr_linenumber" name="L146" href="#L146">146</a> 
<a class="jxr_linenumber" name="L147" href="#L147">147</a>             assertEquals(CTYPE1.key(), <span class="jxr_string">"GLON-CAR"</span>, hdr.getStringValue(CTYPE1));
<a class="jxr_linenumber" name="L148" href="#L148">148</a>             assertEquals(CRPIX2.key(), 0., hdr.getDoubleValue(CRPIX2, -2.), 0);
<a class="jxr_linenumber" name="L149" href="#L149">149</a> 
<a class="jxr_linenumber" name="L150" href="#L150">150</a>             c.setKey(CRVAL1.key());
<a class="jxr_linenumber" name="L151" href="#L151">151</a>             HeaderCard hc = (HeaderCard) c.next();
<a class="jxr_linenumber" name="L152" href="#L152">152</a>             assertEquals(<span class="jxr_string">"CRVAL1_c"</span>, CRVAL1.key(), hc.getKey());
<a class="jxr_linenumber" name="L153" href="#L153">153</a>             hc = (HeaderCard) c.next();
<a class="jxr_linenumber" name="L154" href="#L154">154</a>             assertEquals(<span class="jxr_string">"CRPIX1_c"</span>, CRPIX1.key(), hc.getKey());
<a class="jxr_linenumber" name="L155" href="#L155">155</a>             hc = (HeaderCard) c.next();
<a class="jxr_linenumber" name="L156" href="#L156">156</a>             assertEquals(<span class="jxr_string">"CTYPE1_c"</span>, CTYPE1.key(), hc.getKey());
<a class="jxr_linenumber" name="L157" href="#L157">157</a>             hc = (HeaderCard) c.next();
<a class="jxr_linenumber" name="L158" href="#L158">158</a>             assertEquals(<span class="jxr_string">"CRVAL2_c"</span>, CRVAL2.key(), hc.getKey());
<a class="jxr_linenumber" name="L159" href="#L159">159</a>             hc = (HeaderCard) c.next();
<a class="jxr_linenumber" name="L160" href="#L160">160</a>             assertEquals(<span class="jxr_string">"CRPIX2_c"</span>, CRPIX2.key(), hc.getKey());
<a class="jxr_linenumber" name="L161" href="#L161">161</a>             hc = (HeaderCard) c.next();
<a class="jxr_linenumber" name="L162" href="#L162">162</a>             assertEquals(<span class="jxr_string">"INV2_c"</span>, <span class="jxr_string">"INV2"</span>, hc.getKey());
<a class="jxr_linenumber" name="L163" href="#L163">163</a>             hc = (HeaderCard) c.next();
<a class="jxr_linenumber" name="L164" href="#L164">164</a>             assertEquals(<span class="jxr_string">"SYM2_c"</span>, <span class="jxr_string">"SYM2"</span>, hc.getKey());
<a class="jxr_linenumber" name="L165" href="#L165">165</a>             hc = (HeaderCard) c.next();
<a class="jxr_linenumber" name="L166" href="#L166">166</a>             assertEquals(<span class="jxr_string">"CTYPE2_c"</span>, CTYPE2.key(), hc.getKey());
<a class="jxr_linenumber" name="L167" href="#L167">167</a> 
<a class="jxr_linenumber" name="L168" href="#L168">168</a>             hdr.findCard(CRPIX1.key());
<a class="jxr_linenumber" name="L169" href="#L169">169</a>             hdr.addValue(<span class="jxr_string">"INTVAL1"</span>, 1, <span class="jxr_string">"An integer value"</span>);
<a class="jxr_linenumber" name="L170" href="#L170">170</a>             hdr.addValue(<span class="jxr_string">"LOG1"</span>, <strong class="jxr_keyword">true</strong>, <span class="jxr_string">"A true value"</span>);
<a class="jxr_linenumber" name="L171" href="#L171">171</a>             hdr.addValue(<span class="jxr_string">"LOGB1"</span>, false, <span class="jxr_string">"A false value"</span>);
<a class="jxr_linenumber" name="L172" href="#L172">172</a>             hdr.addValue(<span class="jxr_string">"FLT1"</span>, 1.34, <span class="jxr_string">"A float value"</span>);
<a class="jxr_linenumber" name="L173" href="#L173">173</a>             hdr.addValue(<span class="jxr_string">"FLT2"</span>, -1.234567890e-134, <span class="jxr_string">"A very long float"</span>);
<a class="jxr_linenumber" name="L174" href="#L174">174</a>             hdr.insertComment(<span class="jxr_string">"Comment after flt2"</span>);
<a class="jxr_linenumber" name="L175" href="#L175">175</a> 
<a class="jxr_linenumber" name="L176" href="#L176">176</a>             c.setKey(<span class="jxr_string">"INTVAL1"</span>);
<a class="jxr_linenumber" name="L177" href="#L177">177</a>             hc = (HeaderCard) c.next();
<a class="jxr_linenumber" name="L178" href="#L178">178</a>             assertEquals(<span class="jxr_string">"INTVAL1"</span>, <span class="jxr_string">"INTVAL1"</span>, hc.getKey());
<a class="jxr_linenumber" name="L179" href="#L179">179</a>             hc = (HeaderCard) c.next();
<a class="jxr_linenumber" name="L180" href="#L180">180</a>             assertEquals(<span class="jxr_string">"LOG1"</span>, <span class="jxr_string">"LOG1"</span>, hc.getKey());
<a class="jxr_linenumber" name="L181" href="#L181">181</a>             hc = (HeaderCard) c.next();
<a class="jxr_linenumber" name="L182" href="#L182">182</a>             assertEquals(<span class="jxr_string">"LOGB1"</span>, <span class="jxr_string">"LOGB1"</span>, hc.getKey());
<a class="jxr_linenumber" name="L183" href="#L183">183</a>             hc = (HeaderCard) c.next();
<a class="jxr_linenumber" name="L184" href="#L184">184</a>             assertEquals(<span class="jxr_string">"FLT1"</span>, <span class="jxr_string">"FLT1"</span>, hc.getKey());
<a class="jxr_linenumber" name="L185" href="#L185">185</a>             hc = (HeaderCard) c.next();
<a class="jxr_linenumber" name="L186" href="#L186">186</a>             assertEquals(<span class="jxr_string">"FLT2"</span>, <span class="jxr_string">"FLT2"</span>, hc.getKey());
<a class="jxr_linenumber" name="L187" href="#L187">187</a>             c.next(); <em class="jxr_comment">// Skip comment</em>
<a class="jxr_linenumber" name="L188" href="#L188">188</a>             hc = (HeaderCard) c.next();
<a class="jxr_linenumber" name="L189" href="#L189">189</a>             assertEquals(<span class="jxr_string">"CRPIX1x"</span>, CRPIX1.key(), hc.getKey());
<a class="jxr_linenumber" name="L190" href="#L190">190</a> 
<a class="jxr_linenumber" name="L191" href="#L191">191</a>             assertEquals(<span class="jxr_string">"FLT1"</span>, 1.34, hdr.getDoubleValue(<span class="jxr_string">"FLT1"</span>, 0), 0);
<a class="jxr_linenumber" name="L192" href="#L192">192</a>             c.setKey(<span class="jxr_string">"FLT1"</span>);
<a class="jxr_linenumber" name="L193" href="#L193">193</a>             c.next();
<a class="jxr_linenumber" name="L194" href="#L194">194</a>             c.remove();
<a class="jxr_linenumber" name="L195" href="#L195">195</a>             assertEquals(<span class="jxr_string">"FLT1"</span>, 0., hdr.getDoubleValue(<span class="jxr_string">"FLT1"</span>, 0), 0);
<a class="jxr_linenumber" name="L196" href="#L196">196</a>             assertEquals(<span class="jxr_string">"FLT1"</span>, BigDecimal.valueOf(0.).doubleValue(), hdr.getBigDecimalValue(<span class="jxr_string">"FLT1"</span>).doubleValue(), 0.00000000001);
<a class="jxr_linenumber" name="L197" href="#L197">197</a>             c.setKey(<span class="jxr_string">"LOGB1"</span>);
<a class="jxr_linenumber" name="L198" href="#L198">198</a>             hc = (HeaderCard) c.next();
<a class="jxr_linenumber" name="L199" href="#L199">199</a>             assertEquals(<span class="jxr_string">"AftDel1"</span>, <span class="jxr_string">"LOGB1"</span>, hc.getKey());
<a class="jxr_linenumber" name="L200" href="#L200">200</a>             hc = (HeaderCard) c.next();
<a class="jxr_linenumber" name="L201" href="#L201">201</a>             assertEquals(<span class="jxr_string">"AftDel2"</span>, <span class="jxr_string">"FLT2"</span>, hc.getKey());
<a class="jxr_linenumber" name="L202" href="#L202">202</a>             hc = (HeaderCard) c.next();
<a class="jxr_linenumber" name="L203" href="#L203">203</a>             assertEquals(<span class="jxr_string">"AftDel3"</span>, <span class="jxr_string">"Comment after flt2"</span>, hc.getComment());
<a class="jxr_linenumber" name="L204" href="#L204">204</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L205" href="#L205">205</a>             SafeClose.close(f);
<a class="jxr_linenumber" name="L206" href="#L206">206</a>         }
<a class="jxr_linenumber" name="L207" href="#L207">207</a>     }
<a class="jxr_linenumber" name="L208" href="#L208">208</a> 
<a class="jxr_linenumber" name="L209" href="#L209">209</a>     <em class="jxr_javadoccomment">/** Confirm initial location versus EXTEND keyword (V. Forchi). */</em>
<a class="jxr_linenumber" name="L210" href="#L210">210</a>     @Test
<a class="jxr_linenumber" name="L211" href="#L211">211</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> extendTest() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L212" href="#L212">212</a>         Fits f = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L213" href="#L213">213</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L214" href="#L214">214</a>             f = <strong class="jxr_keyword">new</strong> Fits(<span class="jxr_string">"target/ht1.fits"</span>);
<a class="jxr_linenumber" name="L215" href="#L215">215</a>             Header h = f.getHDU(0).getHeader();
<a class="jxr_linenumber" name="L216" href="#L216">216</a>             h.addValue(<span class="jxr_string">"TESTKEY"</span>, <span class="jxr_string">"TESTVAL"</span>, <span class="jxr_string">"TESTCOMM"</span>);
<a class="jxr_linenumber" name="L217" href="#L217">217</a>             h.rewrite();
<a class="jxr_linenumber" name="L218" href="#L218">218</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L219" href="#L219">219</a>             SafeClose.close(f);
<a class="jxr_linenumber" name="L220" href="#L220">220</a>         }
<a class="jxr_linenumber" name="L221" href="#L221">221</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L222" href="#L222">222</a>             f = <strong class="jxr_keyword">new</strong> Fits(<span class="jxr_string">"target/ht1.fits"</span>);
<a class="jxr_linenumber" name="L223" href="#L223">223</a>             Header h = f.getHDU(0).getHeader();
<a class="jxr_linenumber" name="L224" href="#L224">224</a> 
<a class="jxr_linenumber" name="L225" href="#L225">225</a>             <em class="jxr_comment">// We should be pointed after the EXTEND and before TESTKEY</em>
<a class="jxr_linenumber" name="L226" href="#L226">226</a>             h.addValue(<span class="jxr_string">"TESTKEY2"</span>, <span class="jxr_string">"TESTVAL2"</span>, <strong class="jxr_keyword">null</strong>); <em class="jxr_comment">// Should precede TESTKEY</em>
<a class="jxr_linenumber" name="L227" href="#L227">227</a> 
<a class="jxr_linenumber" name="L228" href="#L228">228</a>             Cursor&lt;String, HeaderCard&gt; c = h.iterator();
<a class="jxr_linenumber" name="L229" href="#L229">229</a>             assertEquals(<span class="jxr_string">"E1"</span>, c.next().getKey(), SIMPLE.key());
<a class="jxr_linenumber" name="L230" href="#L230">230</a>             assertEquals(<span class="jxr_string">"E2"</span>, c.next().getKey(), BITPIX.key());
<a class="jxr_linenumber" name="L231" href="#L231">231</a>             assertEquals(<span class="jxr_string">"E3"</span>, c.next().getKey(), NAXIS.key());
<a class="jxr_linenumber" name="L232" href="#L232">232</a>             assertEquals(<span class="jxr_string">"E4"</span>, c.next().getKey(), NAXISn.n(1).key());
<a class="jxr_linenumber" name="L233" href="#L233">233</a>             assertEquals(<span class="jxr_string">"E5"</span>, c.next().getKey(), NAXISn.n(2).key());
<a class="jxr_linenumber" name="L234" href="#L234">234</a>             assertEquals(<span class="jxr_string">"E6"</span>, c.next().getKey(), EXTEND.key());
<a class="jxr_linenumber" name="L235" href="#L235">235</a>             assertEquals(<span class="jxr_string">"E7"</span>, c.next().getKey(), <span class="jxr_string">"TESTKEY2"</span>);
<a class="jxr_linenumber" name="L236" href="#L236">236</a>             assertEquals(<span class="jxr_string">"E8"</span>, c.next().getKey(), <span class="jxr_string">"TESTKEY"</span>);
<a class="jxr_linenumber" name="L237" href="#L237">237</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L238" href="#L238">238</a>             SafeClose.close(f);
<a class="jxr_linenumber" name="L239" href="#L239">239</a>         }
<a class="jxr_linenumber" name="L240" href="#L240">240</a>     }
<a class="jxr_linenumber" name="L241" href="#L241">241</a> 
<a class="jxr_linenumber" name="L242" href="#L242">242</a>     @Test
<a class="jxr_linenumber" name="L243" href="#L243">243</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> longStringTest() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L244" href="#L244">244</a>         FitsFactory.setLongStringsEnabled(false);
<a class="jxr_linenumber" name="L245" href="#L245">245</a>         String seq = <span class="jxr_string">"0123456789"</span>;
<a class="jxr_linenumber" name="L246" href="#L246">246</a>         String lng = <span class="jxr_string">""</span>;
<a class="jxr_linenumber" name="L247" href="#L247">247</a>         String sixty = seq + seq + seq + seq + seq + seq;
<a class="jxr_linenumber" name="L248" href="#L248">248</a> 
<a class="jxr_linenumber" name="L249" href="#L249">249</a>         <strong class="jxr_keyword">for</strong> (<strong class="jxr_keyword">int</strong> i = 0; i &lt; 20; i += 1) {
<a class="jxr_linenumber" name="L250" href="#L250">250</a>             lng += seq;
<a class="jxr_linenumber" name="L251" href="#L251">251</a>         }
<a class="jxr_linenumber" name="L252" href="#L252">252</a>         Fits f = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L253" href="#L253">253</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L254" href="#L254">254</a>             f = <strong class="jxr_keyword">new</strong> Fits(<span class="jxr_string">"target/ht1.fits"</span>);
<a class="jxr_linenumber" name="L255" href="#L255">255</a>             Header hdr = f.getHDU(0).getHeader();
<a class="jxr_linenumber" name="L256" href="#L256">256</a>             assertEquals(<span class="jxr_string">"Initial state:"</span>, false, FitsFactory.isLongStringsEnabled());
<a class="jxr_linenumber" name="L257" href="#L257">257</a>             FitsFactory.setLongStringsEnabled(<strong class="jxr_keyword">true</strong>);
<a class="jxr_linenumber" name="L258" href="#L258">258</a>             assertEquals(<span class="jxr_string">"Set state:"</span>, <strong class="jxr_keyword">true</strong>, FitsFactory.isLongStringsEnabled());
<a class="jxr_linenumber" name="L259" href="#L259">259</a>             hdr.addValue(<span class="jxr_string">"LONG1"</span>, lng, <span class="jxr_string">"Here is a comment that is also very long and will be truncated at least a little"</span>);
<a class="jxr_linenumber" name="L260" href="#L260">260</a>             hdr.addValue(<span class="jxr_string">"LONG2"</span>, <span class="jxr_string">"xx'yy'zz"</span> + lng, <span class="jxr_string">"Another comment"</span>);
<a class="jxr_linenumber" name="L261" href="#L261">261</a>             hdr.addValue(<span class="jxr_string">"LONG3"</span>, <span class="jxr_string">"xx'yy'zz"</span> + lng, <strong class="jxr_keyword">null</strong>);
<a class="jxr_linenumber" name="L262" href="#L262">262</a>             hdr.addValue(<span class="jxr_string">"SHORT"</span>, <span class="jxr_string">"A STRING ENDING IN A &amp;"</span>, <strong class="jxr_keyword">null</strong>);
<a class="jxr_linenumber" name="L263" href="#L263">263</a>             hdr.addValue(<span class="jxr_string">"LONGISH"</span>, lng + <span class="jxr_string">"&amp;"</span>, <strong class="jxr_keyword">null</strong>);
<a class="jxr_linenumber" name="L264" href="#L264">264</a>             hdr.addValue(<span class="jxr_string">"LONGSTRN"</span>, <span class="jxr_string">"OGIP 1.0"</span>, <span class="jxr_string">"Uses long strings"</span>);
<a class="jxr_linenumber" name="L265" href="#L265">265</a> 
<a class="jxr_linenumber" name="L266" href="#L266">266</a>             hdr.addValue(<span class="jxr_string">"APOS1"</span>, sixty + <span class="jxr_string">"''''''''''"</span>, <span class="jxr_string">"Should be 70 chars long"</span>);
<a class="jxr_linenumber" name="L267" href="#L267">267</a>             hdr.addValue(<span class="jxr_string">"APOS2"</span>, sixty + <span class="jxr_string">" ''''''''''"</span>, <span class="jxr_string">"Should be 71 chars long"</span>);
<a class="jxr_linenumber" name="L268" href="#L268">268</a> 
<a class="jxr_linenumber" name="L269" href="#L269">269</a>             <em class="jxr_comment">// Now try to read the values back.</em>
<a class="jxr_linenumber" name="L270" href="#L270">270</a>             BufferedFile bf = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L271" href="#L271">271</a>             <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L272" href="#L272">272</a>                 bf = <strong class="jxr_keyword">new</strong> BufferedFile(<span class="jxr_string">"target/ht4.hdr"</span>, <span class="jxr_string">"rw"</span>);
<a class="jxr_linenumber" name="L273" href="#L273">273</a>                 hdr.write(bf);
<a class="jxr_linenumber" name="L274" href="#L274">274</a>             } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L275" href="#L275">275</a>                 SafeClose.close(bf);
<a class="jxr_linenumber" name="L276" href="#L276">276</a>             }
<a class="jxr_linenumber" name="L277" href="#L277">277</a>             String val = hdr.getStringValue(<span class="jxr_string">"LONG1"</span>);
<a class="jxr_linenumber" name="L278" href="#L278">278</a>             assertEquals(<span class="jxr_string">"LongT1"</span>, val, lng);
<a class="jxr_linenumber" name="L279" href="#L279">279</a>             val = hdr.getStringValue(<span class="jxr_string">"LONG2"</span>);
<a class="jxr_linenumber" name="L280" href="#L280">280</a>             assertEquals(<span class="jxr_string">"LongT2"</span>, val, <span class="jxr_string">"xx'yy'zz"</span> + lng);
<a class="jxr_linenumber" name="L281" href="#L281">281</a>             assertEquals(<span class="jxr_string">"APOS1"</span>, hdr.getStringValue(<span class="jxr_string">"APOS1"</span>).length(), 70);
<a class="jxr_linenumber" name="L282" href="#L282">282</a>             assertEquals(<span class="jxr_string">"APOS2"</span>, hdr.getStringValue(<span class="jxr_string">"APOS2"</span>).length(), 71);
<a class="jxr_linenumber" name="L283" href="#L283">283</a> 
<a class="jxr_linenumber" name="L284" href="#L284">284</a>             <em class="jxr_comment">// long3 should not have a comment!</em>
<a class="jxr_linenumber" name="L285" href="#L285">285</a>             assertNull(hdr.findCard(<span class="jxr_string">"LONG3"</span>).getComment());
<a class="jxr_linenumber" name="L286" href="#L286">286</a> 
<a class="jxr_linenumber" name="L287" href="#L287">287</a>             String string = hdr.findCard(<span class="jxr_string">"LONG1"</span>).toString();
<a class="jxr_linenumber" name="L288" href="#L288">288</a>             val = FitsHeaderCardParser.parseCardValue(string).getValue();
<a class="jxr_linenumber" name="L289" href="#L289">289</a>             FitsFactory.setLongStringsEnabled(false);
<a class="jxr_linenumber" name="L290" href="#L290">290</a>             val = FitsHeaderCardParser.parseCardValue(string).getValue();
<a class="jxr_linenumber" name="L291" href="#L291">291</a>             FitsFactory.setLongStringsEnabled(<strong class="jxr_keyword">true</strong>);
<a class="jxr_linenumber" name="L292" href="#L292">292</a> 
<a class="jxr_linenumber" name="L293" href="#L293">293</a>             assertEquals(<span class="jxr_string">"LongT3"</span>, <strong class="jxr_keyword">true</strong>, !val.equals(lng));
<a class="jxr_linenumber" name="L294" href="#L294">294</a>             assertEquals(<span class="jxr_string">"Longt4"</span>, <strong class="jxr_keyword">true</strong>, val.length() &lt;= 70);
<a class="jxr_linenumber" name="L295" href="#L295">295</a>             assertEquals(<span class="jxr_string">"longamp1"</span>, hdr.getStringValue(<span class="jxr_string">"SHORT"</span>), <span class="jxr_string">"A STRING ENDING IN A &amp;"</span>);
<a class="jxr_linenumber" name="L296" href="#L296">296</a>             <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L297" href="#L297">297</a>                 bf = <strong class="jxr_keyword">new</strong> BufferedFile(<span class="jxr_string">"target/ht4.hdr"</span>, <span class="jxr_string">"r"</span>);
<a class="jxr_linenumber" name="L298" href="#L298">298</a>                 hdr = <strong class="jxr_keyword">new</strong> Header(bf);
<a class="jxr_linenumber" name="L299" href="#L299">299</a>                 assertEquals(<span class="jxr_string">"Set state2:"</span>, <strong class="jxr_keyword">true</strong>, FitsFactory.isLongStringsEnabled());
<a class="jxr_linenumber" name="L300" href="#L300">300</a>                 val = hdr.getStringValue(<span class="jxr_string">"LONG1"</span>);
<a class="jxr_linenumber" name="L301" href="#L301">301</a>                 assertEquals(<span class="jxr_string">"LongT5"</span>, val, lng);
<a class="jxr_linenumber" name="L302" href="#L302">302</a>                 val = hdr.getStringValue(<span class="jxr_string">"LONG2"</span>);
<a class="jxr_linenumber" name="L303" href="#L303">303</a>                 assertEquals(<span class="jxr_string">"LongT6"</span>, val, <span class="jxr_string">"xx'yy'zz"</span> + lng);
<a class="jxr_linenumber" name="L304" href="#L304">304</a>                 assertEquals(<span class="jxr_string">"longamp2"</span>, hdr.getStringValue(<span class="jxr_string">"LONGISH"</span>), lng + <span class="jxr_string">"&amp;"</span>);
<a class="jxr_linenumber" name="L305" href="#L305">305</a>                 assertEquals(<span class="jxr_string">"APOS1b"</span>, hdr.getStringValue(<span class="jxr_string">"APOS1"</span>).length(), 70);
<a class="jxr_linenumber" name="L306" href="#L306">306</a>                 assertEquals(<span class="jxr_string">"APOS2b"</span>, hdr.getStringValue(<span class="jxr_string">"APOS2"</span>).length(), 71);
<a class="jxr_linenumber" name="L307" href="#L307">307</a>                 assertEquals(<span class="jxr_string">"APOS2c"</span>, hdr.getStringValue(<span class="jxr_string">"APOS2"</span>), sixty + <span class="jxr_string">" ''''''''''"</span>);
<a class="jxr_linenumber" name="L308" href="#L308">308</a>                 assertEquals(<span class="jxr_string">"longamp1b"</span>, hdr.getStringValue(<span class="jxr_string">"SHORT"</span>), <span class="jxr_string">"A STRING ENDING IN A &amp;"</span>);
<a class="jxr_linenumber" name="L309" href="#L309">309</a>                 assertEquals(<span class="jxr_string">"longamp2b"</span>, hdr.getStringValue(<span class="jxr_string">"LONGISH"</span>), lng + <span class="jxr_string">"&amp;"</span>);
<a class="jxr_linenumber" name="L310" href="#L310">310</a> 
<a class="jxr_linenumber" name="L311" href="#L311">311</a>                 <strong class="jxr_keyword">int</strong> cnt = hdr.getNumberOfCards();
<a class="jxr_linenumber" name="L312" href="#L312">312</a>                 <strong class="jxr_keyword">int</strong> pcnt = hdr.getNumberOfPhysicalCards();
<a class="jxr_linenumber" name="L313" href="#L313">313</a>                 <em class="jxr_comment">// This should remove all three cards associated with</em>
<a class="jxr_linenumber" name="L314" href="#L314">314</a>                 <em class="jxr_comment">// LONG1</em>
<a class="jxr_linenumber" name="L315" href="#L315">315</a>                 hdr.removeCard(<span class="jxr_string">"LONG1"</span>);
<a class="jxr_linenumber" name="L316" href="#L316">316</a>                 assertEquals(<span class="jxr_string">"deltest"</span>, cnt - 1, hdr.getNumberOfCards());
<a class="jxr_linenumber" name="L317" href="#L317">317</a>                 assertEquals(<span class="jxr_string">"deltest"</span>, pcnt - 4, hdr.getNumberOfPhysicalCards());
<a class="jxr_linenumber" name="L318" href="#L318">318</a> 
<a class="jxr_linenumber" name="L319" href="#L319">319</a>                 hdr.removeCard(<span class="jxr_string">"LONG2"</span>);
<a class="jxr_linenumber" name="L320" href="#L320">320</a>                 assertEquals(<span class="jxr_string">"deltest2"</span>, pcnt - 8, hdr.getNumberOfPhysicalCards());
<a class="jxr_linenumber" name="L321" href="#L321">321</a>                 assertEquals(<span class="jxr_string">"deltest2"</span>, cnt - 2, hdr.getNumberOfCards());
<a class="jxr_linenumber" name="L322" href="#L322">322</a>             } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L323" href="#L323">323</a>                 SafeClose.close(bf);
<a class="jxr_linenumber" name="L324" href="#L324">324</a>             }
<a class="jxr_linenumber" name="L325" href="#L325">325</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L326" href="#L326">326</a>             SafeClose.close(f);
<a class="jxr_linenumber" name="L327" href="#L327">327</a>         }
<a class="jxr_linenumber" name="L328" href="#L328">328</a>     }
<a class="jxr_linenumber" name="L329" href="#L329">329</a> 
<a class="jxr_linenumber" name="L330" href="#L330">330</a>     @Test
<a class="jxr_linenumber" name="L331" href="#L331">331</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> longStringTest2() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L332" href="#L332">332</a>         FitsFactory.setLongStringsEnabled(<strong class="jxr_keyword">true</strong>);
<a class="jxr_linenumber" name="L333" href="#L333">333</a>         HeaderCard card = HeaderCard.create(<span class="jxr_string">"STRKEY  = 'This is a very long string keyword&amp;'  / Optional Comment             "</span> + <em class="jxr_comment">//</em>
<a class="jxr_linenumber" name="L334" href="#L334">334</a>                 <span class="jxr_string">"CONTINUE  ' value that is continued over 3 keywords in the &amp;  '                 "</span> + <em class="jxr_comment">//</em>
<a class="jxr_linenumber" name="L335" href="#L335">335</a>                 <span class="jxr_string">"CONTINUE  'FITS header.' / This is another optional comment.                    "</span>);
<a class="jxr_linenumber" name="L336" href="#L336">336</a> 
<a class="jxr_linenumber" name="L337" href="#L337">337</a>         assertEquals(<span class="jxr_string">"This is a very long string keyword value that is continued over 3 keywords in the FITS header."</span>, card.getValue());
<a class="jxr_linenumber" name="L338" href="#L338">338</a>         assertEquals(<span class="jxr_string">"Optional Comment This is another optional comment."</span>, card.getComment());
<a class="jxr_linenumber" name="L339" href="#L339">339</a> 
<a class="jxr_linenumber" name="L340" href="#L340">340</a>         card = HeaderCard.create(<span class="jxr_string">"STRKEY  = 'This is a very long string keyword&amp;'  / Optional Comment             "</span> + <em class="jxr_comment">//</em>
<a class="jxr_linenumber" name="L341" href="#L341">341</a>                 <span class="jxr_string">"CONTINUE  ' value that is continued over 2 keywords        &amp;  '                 "</span> + <em class="jxr_comment">//</em>
<a class="jxr_linenumber" name="L342" href="#L342">342</a>                 <span class="jxr_string">"STRKEY2 = 'This is a very long string keyword '  / Optional Comment             "</span>);
<a class="jxr_linenumber" name="L343" href="#L343">343</a> 
<a class="jxr_linenumber" name="L344" href="#L344">344</a>         assertEquals(<span class="jxr_string">"This is a very long string keyword value that is continued over 2 keywords        &amp;"</span>, card.getValue());
<a class="jxr_linenumber" name="L345" href="#L345">345</a>         assertEquals(<span class="jxr_string">"Optional Comment"</span>, card.getComment());
<a class="jxr_linenumber" name="L346" href="#L346">346</a> 
<a class="jxr_linenumber" name="L347" href="#L347">347</a>         card = <strong class="jxr_keyword">new</strong> HeaderCard(<span class="jxr_string">"LONGSTR"</span>,
<a class="jxr_linenumber" name="L348" href="#L348">348</a>                 <span class="jxr_string">"This is very very very very very very very very very very very very very very very very very very very very very very very very very very very long string value of FITS card"</span>,
<a class="jxr_linenumber" name="L349" href="#L349">349</a>                 <span class="jxr_string">"long longer longest comment"</span>);
<a class="jxr_linenumber" name="L350" href="#L350">350</a>         assertEquals(<span class="jxr_string">"LONGSTR = 'This is very very very very very very very very very very very very&amp;'"</span> + <em class="jxr_comment">//</em>
<a class="jxr_linenumber" name="L351" href="#L351">351</a>                 <span class="jxr_string">"CONTINUE  ' very very very very very very very very very very very very very v&amp;'"</span> + <em class="jxr_comment">//</em>
<a class="jxr_linenumber" name="L352" href="#L352">352</a>                 <span class="jxr_string">"CONTINUE  'ery very long string value of FITS &amp;' / long longer longest comment  "</span> + <em class="jxr_comment">//</em>
<a class="jxr_linenumber" name="L353" href="#L353">353</a>                 <span class="jxr_string">"CONTINUE  'card'                                                                "</span>, card.toString());
<a class="jxr_linenumber" name="L354" href="#L354">354</a> 
<a class="jxr_linenumber" name="L355" href="#L355">355</a>         FitsFactory.setLongStringsEnabled(false);
<a class="jxr_linenumber" name="L356" href="#L356">356</a>     }
<a class="jxr_linenumber" name="L357" href="#L357">357</a> 
<a class="jxr_linenumber" name="L358" href="#L358">358</a>     @Test
<a class="jxr_linenumber" name="L359" href="#L359">359</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> longStringNullComment() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L360" href="#L360">360</a>         FitsFactory.setLongStringsEnabled(<strong class="jxr_keyword">true</strong>);
<a class="jxr_linenumber" name="L361" href="#L361">361</a>         HeaderCard card = HeaderCard.create(<span class="jxr_string">"STRKEY  = 'This is a very long string keyword&amp;'                                 "</span> + <em class="jxr_comment">//</em>
<a class="jxr_linenumber" name="L362" href="#L362">362</a>                 <span class="jxr_string">"CONTINUE  ' value that is continued over 3 keywords in the &amp;  '                 "</span> + <em class="jxr_comment">//</em>
<a class="jxr_linenumber" name="L363" href="#L363">363</a>                 <span class="jxr_string">"CONTINUE  'FITS header.'                                                        "</span>);
<a class="jxr_linenumber" name="L364" href="#L364">364</a> 
<a class="jxr_linenumber" name="L365" href="#L365">365</a>         assertEquals(<span class="jxr_string">"This is a very long string keyword value that is continued over 3 keywords in the FITS header."</span>, card.getValue());
<a class="jxr_linenumber" name="L366" href="#L366">366</a>         assertNull(card.getComment());
<a class="jxr_linenumber" name="L367" href="#L367">367</a>         assertFalse(<strong class="jxr_keyword">new</strong> HeaderCard(<span class="jxr_string">"STRKEY"</span>,
<a class="jxr_linenumber" name="L368" href="#L368">368</a>                 <span class="jxr_string">"This is a very long string keyword value that is continued over at least three keywords in the FITS header even if it has no comment."</span>, <strong class="jxr_keyword">null</strong>).toString()
<a class="jxr_linenumber" name="L369" href="#L369">369</a>                         .contains(<span class="jxr_string">"/"</span>));
<a class="jxr_linenumber" name="L370" href="#L370">370</a>         FitsFactory.setLongStringsEnabled(false);
<a class="jxr_linenumber" name="L371" href="#L371">371</a>     }
<a class="jxr_linenumber" name="L372" href="#L372">372</a> 
<a class="jxr_linenumber" name="L373" href="#L373">373</a>     @Test
<a class="jxr_linenumber" name="L374" href="#L374">374</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> longStringTestAny() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L375" href="#L375">375</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L376" href="#L376">376</a>             String value = <span class="jxr_string">"0"</span>;
<a class="jxr_linenumber" name="L377" href="#L377">377</a>             String comment = <span class="jxr_string">"0"</span>;
<a class="jxr_linenumber" name="L378" href="#L378">378</a> 
<a class="jxr_linenumber" name="L379" href="#L379">379</a>             <strong class="jxr_keyword">for</strong> (<strong class="jxr_keyword">int</strong> valueSize = 0; valueSize &lt; 250; valueSize++) {
<a class="jxr_linenumber" name="L380" href="#L380">380</a>                 <strong class="jxr_keyword">for</strong> (<strong class="jxr_keyword">int</strong> commentSize = 0; commentSize &lt; 50; commentSize++) {
<a class="jxr_linenumber" name="L381" href="#L381">381</a>                     String cardValue = value.substring(0, valueSize);
<a class="jxr_linenumber" name="L382" href="#L382">382</a>                     String cardComment = comment.substring(0, commentSize);
<a class="jxr_linenumber" name="L383" href="#L383">383</a> 
<a class="jxr_linenumber" name="L384" href="#L384">384</a>                     FitsFactory.setLongStringsEnabled(false);
<a class="jxr_linenumber" name="L385" href="#L385">385</a>                     checkOneCombination(cardValue, cardComment);
<a class="jxr_linenumber" name="L386" href="#L386">386</a>                     FitsFactory.setLongStringsEnabled(<strong class="jxr_keyword">true</strong>);
<a class="jxr_linenumber" name="L387" href="#L387">387</a>                     checkOneCombination(cardValue, cardComment);
<a class="jxr_linenumber" name="L388" href="#L388">388</a> 
<a class="jxr_linenumber" name="L389" href="#L389">389</a>                     comment = comment + ((Integer.parseInt(comment.substring(comment.length() - 1)) + 1) % 10);
<a class="jxr_linenumber" name="L390" href="#L390">390</a>                 }
<a class="jxr_linenumber" name="L391" href="#L391">391</a>                 value = value + ((Integer.parseInt(value.substring(value.length() - 1)) + 1) % 10);
<a class="jxr_linenumber" name="L392" href="#L392">392</a>             }
<a class="jxr_linenumber" name="L393" href="#L393">393</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L394" href="#L394">394</a>             FitsFactory.setLongStringsEnabled(false);
<a class="jxr_linenumber" name="L395" href="#L395">395</a>         }
<a class="jxr_linenumber" name="L396" href="#L396">396</a>     }
<a class="jxr_linenumber" name="L397" href="#L397">397</a> 
<a class="jxr_linenumber" name="L398" href="#L398">398</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L399" href="#L399">399</a> <em class="jxr_javadoccomment">     * split in own method, for debugging (drop to frame)</em>
<a class="jxr_linenumber" name="L400" href="#L400">400</a> <em class="jxr_javadoccomment">     * </em>
<a class="jxr_linenumber" name="L401" href="#L401">401</a> <em class="jxr_javadoccomment">     * @param cardValue</em>
<a class="jxr_linenumber" name="L402" href="#L402">402</a> <em class="jxr_javadoccomment">     * @param cardComment</em>
<a class="jxr_linenumber" name="L403" href="#L403">403</a> <em class="jxr_javadoccomment">     * @throws Exception</em>
<a class="jxr_linenumber" name="L404" href="#L404">404</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="L405" href="#L405">405</a>     <strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">void</strong> checkOneCombination(String cardValue, String cardComment) <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L406" href="#L406">406</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L407" href="#L407">407</a>             HeaderCard headerCard = <strong class="jxr_keyword">new</strong> HeaderCard(<span class="jxr_string">"CARD"</span>, cardValue, cardComment);
<a class="jxr_linenumber" name="L408" href="#L408">408</a>             String cardString = headerCard.toString();
<a class="jxr_linenumber" name="L409" href="#L409">409</a>             assertEquals(cardString.length(), headerCard.cardSize() * 80);
<a class="jxr_linenumber" name="L410" href="#L410">410</a>             byte[] bytes = <strong class="jxr_keyword">new</strong> byte[cardString.length() + 160];
<a class="jxr_linenumber" name="L411" href="#L411">411</a>             Arrays.fill(bytes, (byte) ' ');
<a class="jxr_linenumber" name="L412" href="#L412">412</a>             System.arraycopy(AsciiFuncs.getBytes(cardString), 0, bytes, 0, cardString.length());
<a class="jxr_linenumber" name="L413" href="#L413">413</a>             HeaderCard rereadCard = <strong class="jxr_keyword">new</strong> HeaderCard(<strong class="jxr_keyword">new</strong> BufferedDataInputStream(<strong class="jxr_keyword">new</strong> ByteArrayInputStream(bytes)));
<a class="jxr_linenumber" name="L414" href="#L414">414</a> 
<a class="jxr_linenumber" name="L415" href="#L415">415</a>             assertEquals(cardValue, rereadCard.getValue());
<a class="jxr_linenumber" name="L416" href="#L416">416</a>             assertEquals(headerCard.getValue(), rereadCard.getValue());
<a class="jxr_linenumber" name="L417" href="#L417">417</a>             assertEquals(cardComment, headerCard.getComment());
<a class="jxr_linenumber" name="L418" href="#L418">418</a>             assertTrue(cardComment.startsWith(rereadCard.getComment() == <strong class="jxr_keyword">null</strong> ? <span class="jxr_string">""</span> : rereadCard.getComment().replaceAll(<span class="jxr_string">" "</span>, <span class="jxr_string">""</span>)));
<a class="jxr_linenumber" name="L419" href="#L419">419</a>         } <strong class="jxr_keyword">catch</strong> (HeaderCardException e) {
<a class="jxr_linenumber" name="L420" href="#L420">420</a>             assertTrue(!FitsFactory.isLongStringsEnabled() &amp;&amp; cardValue.length() &gt; 68);
<a class="jxr_linenumber" name="L421" href="#L421">421</a>         }
<a class="jxr_linenumber" name="L422" href="#L422">422</a>     }
<a class="jxr_linenumber" name="L423" href="#L423">423</a> 
<a class="jxr_linenumber" name="L424" href="#L424">424</a>     <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="L425" href="#L425">425</a> <em class="jxr_javadoccomment">     * Check out header manipulation.</em>
<a class="jxr_linenumber" name="L426" href="#L426">426</a> <em class="jxr_javadoccomment">     */</em>
<a class="jxr_linenumber" name="L427" href="#L427">427</a>     @Test
<a class="jxr_linenumber" name="L428" href="#L428">428</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> simpleImagesTest() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L429" href="#L429">429</a>         Fits f = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L430" href="#L430">430</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L431" href="#L431">431</a>             f = <strong class="jxr_keyword">new</strong> Fits(<span class="jxr_string">"target/ht1.fits"</span>);
<a class="jxr_linenumber" name="L432" href="#L432">432</a>             ImageHDU hdu = (ImageHDU) f.getHDU(0);
<a class="jxr_linenumber" name="L433" href="#L433">433</a>             Header hdr = hdu.getHeader();
<a class="jxr_linenumber" name="L434" href="#L434">434</a> 
<a class="jxr_linenumber" name="L435" href="#L435">435</a>             assertEquals(<span class="jxr_string">"NAXIS"</span>, 2, hdr.getIntValue(NAXIS));
<a class="jxr_linenumber" name="L436" href="#L436">436</a>             assertEquals(<span class="jxr_string">"NAXIS1"</span>, 300, hdr.getIntValue(NAXISn.n(1)));
<a class="jxr_linenumber" name="L437" href="#L437">437</a>             assertEquals(<span class="jxr_string">"NAXIS2"</span>, 300, hdr.getIntValue(NAXISn.n(2)));
<a class="jxr_linenumber" name="L438" href="#L438">438</a>             assertEquals(<span class="jxr_string">"NAXIS2a"</span>, 300, hdr.getIntValue(NAXISn.n(2), -1));
<a class="jxr_linenumber" name="L439" href="#L439">439</a>             assertEquals(<span class="jxr_string">"NAXIS3"</span>, -1, hdr.getIntValue(NAXISn.n(3), -1));
<a class="jxr_linenumber" name="L440" href="#L440">440</a>             assertEquals(<span class="jxr_string">"NAXIS3"</span>, -1, hdr.getIntValue(NAXISn.n(3).key(), -1));
<a class="jxr_linenumber" name="L441" href="#L441">441</a> 
<a class="jxr_linenumber" name="L442" href="#L442">442</a>             assertEquals(<span class="jxr_string">"BITPIX"</span>, BigInteger.valueOf(-32), hdr.getBigIntegerValue(BITPIX.name()));
<a class="jxr_linenumber" name="L443" href="#L443">443</a> 
<a class="jxr_linenumber" name="L444" href="#L444">444</a>             Cursor&lt;String, HeaderCard&gt; c = hdr.iterator();
<a class="jxr_linenumber" name="L445" href="#L445">445</a>             HeaderCard hc = c.next();
<a class="jxr_linenumber" name="L446" href="#L446">446</a>             assertEquals(<span class="jxr_string">"SIMPLE_1"</span>, SIMPLE.key(), hc.getKey());
<a class="jxr_linenumber" name="L447" href="#L447">447</a> 
<a class="jxr_linenumber" name="L448" href="#L448">448</a>             hc = c.next();
<a class="jxr_linenumber" name="L449" href="#L449">449</a>             assertEquals(<span class="jxr_string">"BITPIX_2"</span>, BITPIX.key(), hc.getKey());
<a class="jxr_linenumber" name="L450" href="#L450">450</a> 
<a class="jxr_linenumber" name="L451" href="#L451">451</a>             hc = c.next();
<a class="jxr_linenumber" name="L452" href="#L452">452</a>             assertEquals(<span class="jxr_string">"NAXIS_3"</span>, NAXIS.key(), hc.getKey());
<a class="jxr_linenumber" name="L453" href="#L453">453</a> 
<a class="jxr_linenumber" name="L454" href="#L454">454</a>             hc = c.next();
<a class="jxr_linenumber" name="L455" href="#L455">455</a>             assertEquals(<span class="jxr_string">"NAXIS1_4"</span>, NAXISn.n(1).key(), hc.getKey());
<a class="jxr_linenumber" name="L456" href="#L456">456</a> 
<a class="jxr_linenumber" name="L457" href="#L457">457</a>             hc = c.next();
<a class="jxr_linenumber" name="L458" href="#L458">458</a>             assertEquals(<span class="jxr_string">"NAXIS2_5"</span>, NAXISn.n(2).key(), hc.getKey());
<a class="jxr_linenumber" name="L459" href="#L459">459</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L460" href="#L460">460</a>             SafeClose.close(f);
<a class="jxr_linenumber" name="L461" href="#L461">461</a>         }
<a class="jxr_linenumber" name="L462" href="#L462">462</a>     }
<a class="jxr_linenumber" name="L463" href="#L463">463</a> 
<a class="jxr_linenumber" name="L464" href="#L464">464</a>     @Test
<a class="jxr_linenumber" name="L465" href="#L465">465</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> testBadHeader() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L466" href="#L466">466</a> 
<a class="jxr_linenumber" name="L467" href="#L467">467</a>         Fits f = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L468" href="#L468">468</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L469" href="#L469">469</a>             f = <strong class="jxr_keyword">new</strong> Fits(<span class="jxr_string">"target/ht1.fits"</span>);
<a class="jxr_linenumber" name="L470" href="#L470">470</a>             ImageHDU hdu = (ImageHDU) f.getHDU(0);
<a class="jxr_linenumber" name="L471" href="#L471">471</a>             Header hdr = hdu.getHeader();
<a class="jxr_linenumber" name="L472" href="#L472">472</a>             Cursor&lt;String, HeaderCard&gt; c = hdr.iterator();
<a class="jxr_linenumber" name="L473" href="#L473">473</a> 
<a class="jxr_linenumber" name="L474" href="#L474">474</a>             c = hdr.iterator();
<a class="jxr_linenumber" name="L475" href="#L475">475</a>             c.next();
<a class="jxr_linenumber" name="L476" href="#L476">476</a>             c.next();
<a class="jxr_linenumber" name="L477" href="#L477">477</a>             c.remove();
<a class="jxr_linenumber" name="L478" href="#L478">478</a>             <strong class="jxr_keyword">boolean</strong> thrown = false;
<a class="jxr_linenumber" name="L479" href="#L479">479</a>             <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L480" href="#L480">480</a>                 hdr.rewrite();
<a class="jxr_linenumber" name="L481" href="#L481">481</a>             } <strong class="jxr_keyword">catch</strong> (Exception e) {
<a class="jxr_linenumber" name="L482" href="#L482">482</a>                 thrown = <strong class="jxr_keyword">true</strong>;
<a class="jxr_linenumber" name="L483" href="#L483">483</a>             }
<a class="jxr_linenumber" name="L484" href="#L484">484</a>             assertEquals(<span class="jxr_string">"BITPIX delete"</span>, <strong class="jxr_keyword">true</strong>, thrown);
<a class="jxr_linenumber" name="L485" href="#L485">485</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L486" href="#L486">486</a>             SafeClose.close(f);
<a class="jxr_linenumber" name="L487" href="#L487">487</a>         }
<a class="jxr_linenumber" name="L488" href="#L488">488</a>     }
<a class="jxr_linenumber" name="L489" href="#L489">489</a> 
<a class="jxr_linenumber" name="L490" href="#L490">490</a>     @Test
<a class="jxr_linenumber" name="L491" href="#L491">491</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> testHeaderCommentsDrift() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L492" href="#L492">492</a>         byte[][] z = <strong class="jxr_keyword">new</strong> byte[4][4];
<a class="jxr_linenumber" name="L493" href="#L493">493</a>         Fits f = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L494" href="#L494">494</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L495" href="#L495">495</a>             f = <strong class="jxr_keyword">new</strong> Fits();
<a class="jxr_linenumber" name="L496" href="#L496">496</a>             BasicHDU&lt;?&gt; hdu = FitsFactory.hduFactory(z);
<a class="jxr_linenumber" name="L497" href="#L497">497</a>             f.addHDU(hdu);
<a class="jxr_linenumber" name="L498" href="#L498">498</a>             Cursor&lt;String, HeaderCard&gt; iter = hdu.getHeader().iterator();
<a class="jxr_linenumber" name="L499" href="#L499">499</a>             iter.end();
<a class="jxr_linenumber" name="L500" href="#L500">500</a>             iter.add(<strong class="jxr_keyword">new</strong> HeaderCard(<span class="jxr_string">"KEY"</span>, <span class="jxr_string">"VALUE"</span>, <span class="jxr_string">"COMMENT"</span>));
<a class="jxr_linenumber" name="L501" href="#L501">501</a>             BufferedFile bf = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L502" href="#L502">502</a>             <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L503" href="#L503">503</a>                 bf = <strong class="jxr_keyword">new</strong> BufferedFile(<span class="jxr_string">"target/testHeaderCommentsDrift.fits"</span>, <span class="jxr_string">"rw"</span>);
<a class="jxr_linenumber" name="L504" href="#L504">504</a>                 f.write(bf);
<a class="jxr_linenumber" name="L505" href="#L505">505</a>             } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L506" href="#L506">506</a>                 SafeClose.close(bf);
<a class="jxr_linenumber" name="L507" href="#L507">507</a>             }
<a class="jxr_linenumber" name="L508" href="#L508">508</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L509" href="#L509">509</a>             SafeClose.close(f);
<a class="jxr_linenumber" name="L510" href="#L510">510</a>         }
<a class="jxr_linenumber" name="L511" href="#L511">511</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L512" href="#L512">512</a>             f = <strong class="jxr_keyword">new</strong> Fits(<span class="jxr_string">"target/testHeaderCommentsDrift.fits"</span>);
<a class="jxr_linenumber" name="L513" href="#L513">513</a>             BufferedFile bf = <strong class="jxr_keyword">new</strong> BufferedFile(<span class="jxr_string">"target/testHeaderCommentsDrift.fits"</span>, <span class="jxr_string">"rw"</span>);
<a class="jxr_linenumber" name="L514" href="#L514">514</a>             f.read();
<a class="jxr_linenumber" name="L515" href="#L515">515</a>             f.write(bf);
<a class="jxr_linenumber" name="L516" href="#L516">516</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L517" href="#L517">517</a>             SafeClose.close(f);
<a class="jxr_linenumber" name="L518" href="#L518">518</a>         }
<a class="jxr_linenumber" name="L519" href="#L519">519</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L520" href="#L520">520</a>             f = <strong class="jxr_keyword">new</strong> Fits(<span class="jxr_string">"target/testHeaderCommentsDrift.fits"</span>);
<a class="jxr_linenumber" name="L521" href="#L521">521</a>             f.read();
<a class="jxr_linenumber" name="L522" href="#L522">522</a>             assertEquals(<span class="jxr_string">"COMMENT"</span>, f.getHDU(0).getHeader().findCard(<span class="jxr_string">"KEY"</span>).getComment());
<a class="jxr_linenumber" name="L523" href="#L523">523</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L524" href="#L524">524</a>             SafeClose.close(f);
<a class="jxr_linenumber" name="L525" href="#L525">525</a>         }
<a class="jxr_linenumber" name="L526" href="#L526">526</a>     }
<a class="jxr_linenumber" name="L527" href="#L527">527</a> 
<a class="jxr_linenumber" name="L528" href="#L528">528</a>     @Test
<a class="jxr_linenumber" name="L529" href="#L529">529</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> testHierachKeyWordParsing() {
<a class="jxr_linenumber" name="L530" href="#L530">530</a>         String keyword = FitsHeaderCardParser.parseCardKey(<span class="jxr_string">"HIERARCH test this = 'bla bla' "</span>);
<a class="jxr_linenumber" name="L531" href="#L531">531</a>         assertEquals(<span class="jxr_string">"HIERARCH.TEST.THIS"</span>, keyword);
<a class="jxr_linenumber" name="L532" href="#L532">532</a> 
<a class="jxr_linenumber" name="L533" href="#L533">533</a>         keyword = FitsHeaderCardParser.parseCardKey(<span class="jxr_string">"HIERARCH test this= 'bla bla' "</span>);
<a class="jxr_linenumber" name="L534" href="#L534">534</a>         assertEquals(<span class="jxr_string">"HIERARCH.TEST.THIS"</span>, keyword);
<a class="jxr_linenumber" name="L535" href="#L535">535</a> 
<a class="jxr_linenumber" name="L536" href="#L536">536</a>         keyword = FitsHeaderCardParser.parseCardKey(<span class="jxr_string">"HIERARCH.test.this= 'bla bla' "</span>);
<a class="jxr_linenumber" name="L537" href="#L537">537</a>         assertEquals(<span class="jxr_string">"HIERARCH.TEST.THIS"</span>, keyword);
<a class="jxr_linenumber" name="L538" href="#L538">538</a> 
<a class="jxr_linenumber" name="L539" href="#L539">539</a>         keyword = FitsHeaderCardParser.parseCardKey(<span class="jxr_string">"HIERARCH ESO INS OPTI-3 ID = 'ESO#427 ' / Optical element identifier"</span>);
<a class="jxr_linenumber" name="L540" href="#L540">540</a>         assertEquals(<span class="jxr_string">"HIERARCH.ESO.INS.OPTI-3.ID"</span>, keyword);
<a class="jxr_linenumber" name="L541" href="#L541">541</a> 
<a class="jxr_linenumber" name="L542" href="#L542">542</a>         keyword = FitsHeaderCardParser.parseCardKey(<span class="jxr_string">"HIERARCH ESO INS. OPTI-3 ID = 'ESO#427 ' / Optical element identifier"</span>);
<a class="jxr_linenumber" name="L543" href="#L543">543</a>         assertEquals(<span class="jxr_string">"HIERARCH.ESO.INS.OPTI-3.ID"</span>, keyword);
<a class="jxr_linenumber" name="L544" href="#L544">544</a> 
<a class="jxr_linenumber" name="L545" href="#L545">545</a>         keyword = FitsHeaderCardParser.parseCardKey(<span class="jxr_string">"HIERARCH ESO.INS OPTI-3 ID = 'ESO#427 ' / Optical element identifier"</span>);
<a class="jxr_linenumber" name="L546" href="#L546">546</a>         assertEquals(<span class="jxr_string">"HIERARCH.ESO.INS.OPTI-3.ID"</span>, keyword);
<a class="jxr_linenumber" name="L547" href="#L547">547</a> 
<a class="jxr_linenumber" name="L548" href="#L548">548</a>         keyword = FitsHeaderCardParser.parseCardKey(<span class="jxr_string">"HIERARCH..ESO INS OPTI-3 ID = 'ESO#427 ' / Optical element identifier"</span>);
<a class="jxr_linenumber" name="L549" href="#L549">549</a>         assertEquals(<span class="jxr_string">"HIERARCH.ESO.INS.OPTI-3.ID"</span>, keyword);
<a class="jxr_linenumber" name="L550" href="#L550">550</a> 
<a class="jxr_linenumber" name="L551" href="#L551">551</a>         keyword = FitsHeaderCardParser.parseCardKey(<span class="jxr_string">"HIERARCH    ESO INS   OPTI-3 ID= 'ESO#427 ' / Optical element identifier"</span>);
<a class="jxr_linenumber" name="L552" href="#L552">552</a>         assertEquals(<span class="jxr_string">"HIERARCH.ESO.INS.OPTI-3.ID"</span>, keyword);
<a class="jxr_linenumber" name="L553" href="#L553">553</a> 
<a class="jxr_linenumber" name="L554" href="#L554">554</a>         keyword = FitsHeaderCardParser.parseCardKey(<span class="jxr_string">"sdfajsg sdgf asdgf kasj sjk ID Optical element identifier"</span>);
<a class="jxr_linenumber" name="L555" href="#L555">555</a>         assertEquals(<span class="jxr_string">""</span>, keyword);
<a class="jxr_linenumber" name="L556" href="#L556">556</a> 
<a class="jxr_linenumber" name="L557" href="#L557">557</a>         keyword = FitsHeaderCardParser.parseCardKey(<span class="jxr_string">"SIMPLE = T"</span>);
<a class="jxr_linenumber" name="L558" href="#L558">558</a>         assertEquals(<span class="jxr_string">"SIMPLE"</span>, keyword);
<a class="jxr_linenumber" name="L559" href="#L559">559</a>     }
<a class="jxr_linenumber" name="L560" href="#L560">560</a> 
<a class="jxr_linenumber" name="L561" href="#L561">561</a>     @Test
<a class="jxr_linenumber" name="L562" href="#L562">562</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> testRewrite() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L563" href="#L563">563</a>         <em class="jxr_comment">// Should be rewriteable until we add enough cards to</em>
<a class="jxr_linenumber" name="L564" href="#L564">564</a>         <em class="jxr_comment">// start a new block.</em>
<a class="jxr_linenumber" name="L565" href="#L565">565</a> 
<a class="jxr_linenumber" name="L566" href="#L566">566</a>         Fits f = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L567" href="#L567">567</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L568" href="#L568">568</a>             f = <strong class="jxr_keyword">new</strong> Fits(<span class="jxr_string">"target/ht1.fits"</span>);
<a class="jxr_linenumber" name="L569" href="#L569">569</a>             ImageHDU hdu = (ImageHDU) f.getHDU(0);
<a class="jxr_linenumber" name="L570" href="#L570">570</a>             Header hdr = hdu.getHeader();
<a class="jxr_linenumber" name="L571" href="#L571">571</a>             Cursor&lt;String, HeaderCard&gt; c = hdr.iterator();
<a class="jxr_linenumber" name="L572" href="#L572">572</a> 
<a class="jxr_linenumber" name="L573" href="#L573">573</a>             <strong class="jxr_keyword">int</strong> nc = hdr.getNumberOfCards();
<a class="jxr_linenumber" name="L574" href="#L574">574</a>             <strong class="jxr_keyword">int</strong> nb = (nc - 1) / 36;
<a class="jxr_linenumber" name="L575" href="#L575">575</a> 
<a class="jxr_linenumber" name="L576" href="#L576">576</a>             <strong class="jxr_keyword">while</strong> (hdr.rewriteable()) {
<a class="jxr_linenumber" name="L577" href="#L577">577</a>                 <strong class="jxr_keyword">int</strong> nbx = (hdr.getNumberOfCards() - 1) / 36;
<a class="jxr_linenumber" name="L578" href="#L578">578</a>                 assertEquals(<span class="jxr_string">"Rewrite:"</span> + nbx, nb == nbx, hdr.rewriteable());
<a class="jxr_linenumber" name="L579" href="#L579">579</a>                 c.add(<strong class="jxr_keyword">new</strong> HeaderCard(<span class="jxr_string">"DUMMY"</span> + hdr.getNumberOfCards(), (String) <strong class="jxr_keyword">null</strong>, <strong class="jxr_keyword">null</strong>));
<a class="jxr_linenumber" name="L580" href="#L580">580</a>             }
<a class="jxr_linenumber" name="L581" href="#L581">581</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L582" href="#L582">582</a>             SafeClose.close(f);
<a class="jxr_linenumber" name="L583" href="#L583">583</a>         }
<a class="jxr_linenumber" name="L584" href="#L584">584</a>     }
<a class="jxr_linenumber" name="L585" href="#L585">585</a> 
<a class="jxr_linenumber" name="L586" href="#L586">586</a>     @Test
<a class="jxr_linenumber" name="L587" href="#L587">587</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> testStringLengthProblems() <strong class="jxr_keyword">throws</strong> HeaderCardException {
<a class="jxr_linenumber" name="L588" href="#L588">588</a>         FitsFactory.setLongStringsEnabled(false);
<a class="jxr_linenumber" name="L589" href="#L589">589</a>         HeaderCard card;
<a class="jxr_linenumber" name="L590" href="#L590">590</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L591" href="#L591">591</a>             <strong class="jxr_keyword">new</strong> HeaderCard(<span class="jxr_string">"TESTKEY"</span>, <span class="jxr_string">"random value just for testing purpose - random value just for testing"</span>, <span class="jxr_string">""</span>);
<a class="jxr_linenumber" name="L592" href="#L592">592</a>             fail(<span class="jxr_string">"must trow an value too long exception"</span>);
<a class="jxr_linenumber" name="L593" href="#L593">593</a>         } <strong class="jxr_keyword">catch</strong> (HeaderCardException e) {
<a class="jxr_linenumber" name="L594" href="#L594">594</a>             <em class="jxr_comment">// ok this is expected</em>
<a class="jxr_linenumber" name="L595" href="#L595">595</a>         }
<a class="jxr_linenumber" name="L596" href="#L596">596</a>         <em class="jxr_comment">// now one char less.</em>
<a class="jxr_linenumber" name="L597" href="#L597">597</a>         card = <strong class="jxr_keyword">new</strong> HeaderCard(<span class="jxr_string">"TESTKEY"</span>, <span class="jxr_string">"random value just for testing purpose - random value just for testin"</span>, <span class="jxr_string">""</span>);
<a class="jxr_linenumber" name="L598" href="#L598">598</a>         assertEquals(<span class="jxr_string">"TESTKEY = 'random value just for testing purpose - random value just for testin'"</span>, card.toString());
<a class="jxr_linenumber" name="L599" href="#L599">599</a>     }
<a class="jxr_linenumber" name="L600" href="#L600">600</a> 
<a class="jxr_linenumber" name="L601" href="#L601">601</a>     @Test
<a class="jxr_linenumber" name="L602" href="#L602">602</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> testHeaderComments() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L603" href="#L603">603</a>         Assert.assertNull(HeaderCommentsMap.getComment(<span class="jxr_string">"NOT_PRESENT"</span>));
<a class="jxr_linenumber" name="L604" href="#L604">604</a>     }
<a class="jxr_linenumber" name="L605" href="#L605">605</a> 
<a class="jxr_linenumber" name="L606" href="#L606">606</a>     @Test
<a class="jxr_linenumber" name="L607" href="#L607">607</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> testUpdateHeaderComments() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L608" href="#L608">608</a>         byte[][] z = <strong class="jxr_keyword">new</strong> byte[4][4];
<a class="jxr_linenumber" name="L609" href="#L609">609</a>         Fits f = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L610" href="#L610">610</a>         BufferedFile bf = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L611" href="#L611">611</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L612" href="#L612">612</a>             f = <strong class="jxr_keyword">new</strong> Fits();
<a class="jxr_linenumber" name="L613" href="#L613">613</a>             bf = <strong class="jxr_keyword">new</strong> BufferedFile(<span class="jxr_string">"target/hx1.fits"</span>, <span class="jxr_string">"rw"</span>);
<a class="jxr_linenumber" name="L614" href="#L614">614</a>             f.addHDU(FitsFactory.hduFactory(z));
<a class="jxr_linenumber" name="L615" href="#L615">615</a>             f.write(bf);
<a class="jxr_linenumber" name="L616" href="#L616">616</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L617" href="#L617">617</a>             SafeClose.close(bf);
<a class="jxr_linenumber" name="L618" href="#L618">618</a>             SafeClose.close(f);
<a class="jxr_linenumber" name="L619" href="#L619">619</a>         }
<a class="jxr_linenumber" name="L620" href="#L620">620</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L621" href="#L621">621</a>             f = <strong class="jxr_keyword">new</strong> Fits(<span class="jxr_string">"target/hx1.fits"</span>);
<a class="jxr_linenumber" name="L622" href="#L622">622</a>             f.read();
<a class="jxr_linenumber" name="L623" href="#L623">623</a>             HeaderCard c1 = f.getHDU(0).getHeader().findCard(SIMPLE.key());
<a class="jxr_linenumber" name="L624" href="#L624">624</a>             assertEquals(<span class="jxr_string">"tuhc1"</span>, c1.getComment(), HeaderCommentsMap.getComment(<span class="jxr_string">"header:simple:1"</span>));
<a class="jxr_linenumber" name="L625" href="#L625">625</a>             c1 = f.getHDU(0).getHeader().findCard(BITPIX.key());
<a class="jxr_linenumber" name="L626" href="#L626">626</a>             assertEquals(<span class="jxr_string">"tuhc2"</span>, c1.getComment(), HeaderCommentsMap.getComment(<span class="jxr_string">"header:bitpix:1"</span>));
<a class="jxr_linenumber" name="L627" href="#L627">627</a>             HeaderCommentsMap.updateComment(<span class="jxr_string">"header:bitpix:1"</span>, <span class="jxr_string">"A byte tiledImageOperation"</span>);
<a class="jxr_linenumber" name="L628" href="#L628">628</a>             HeaderCommentsMap.deleteComment(<span class="jxr_string">"header:simple:1"</span>);
<a class="jxr_linenumber" name="L629" href="#L629">629</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L630" href="#L630">630</a>             SafeClose.close(f);
<a class="jxr_linenumber" name="L631" href="#L631">631</a>         }
<a class="jxr_linenumber" name="L632" href="#L632">632</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L633" href="#L633">633</a>             f = <strong class="jxr_keyword">new</strong> Fits();
<a class="jxr_linenumber" name="L634" href="#L634">634</a>             bf = <strong class="jxr_keyword">new</strong> BufferedFile(<span class="jxr_string">"target/hx2.fits"</span>, <span class="jxr_string">"rw"</span>);
<a class="jxr_linenumber" name="L635" href="#L635">635</a>             f.addHDU(FitsFactory.hduFactory(z));
<a class="jxr_linenumber" name="L636" href="#L636">636</a>             f.write(bf);
<a class="jxr_linenumber" name="L637" href="#L637">637</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L638" href="#L638">638</a>             SafeClose.close(bf);
<a class="jxr_linenumber" name="L639" href="#L639">639</a>             SafeClose.close(f);
<a class="jxr_linenumber" name="L640" href="#L640">640</a>         }
<a class="jxr_linenumber" name="L641" href="#L641">641</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L642" href="#L642">642</a>             f = <strong class="jxr_keyword">new</strong> Fits(<span class="jxr_string">"target/hx2.fits"</span>);
<a class="jxr_linenumber" name="L643" href="#L643">643</a>             HeaderCard c1 = f.getHDU(0).getHeader().findCard(SIMPLE.key());
<a class="jxr_linenumber" name="L644" href="#L644">644</a>             assertEquals(<span class="jxr_string">"tuhc1"</span>, c1.getComment(), <strong class="jxr_keyword">null</strong>);
<a class="jxr_linenumber" name="L645" href="#L645">645</a>             c1 = f.getHDU(0).getHeader().findCard(BITPIX.key());
<a class="jxr_linenumber" name="L646" href="#L646">646</a>             assertEquals(<span class="jxr_string">"tuhc2"</span>, c1.getComment(), <span class="jxr_string">"A byte tiledImageOperation"</span>);
<a class="jxr_linenumber" name="L647" href="#L647">647</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L648" href="#L648">648</a>             SafeClose.close(f);
<a class="jxr_linenumber" name="L649" href="#L649">649</a>         }
<a class="jxr_linenumber" name="L650" href="#L650">650</a>     }
<a class="jxr_linenumber" name="L651" href="#L651">651</a> 
<a class="jxr_linenumber" name="L652" href="#L652">652</a>     @Test
<a class="jxr_linenumber" name="L653" href="#L653">653</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> addValueTests() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L654" href="#L654">654</a>         FileInputStream in = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L655" href="#L655">655</a>         Fits fits = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L656" href="#L656">656</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L657" href="#L657">657</a>             in = <strong class="jxr_keyword">new</strong> FileInputStream(<span class="jxr_string">"target/ht1.fits"</span>);
<a class="jxr_linenumber" name="L658" href="#L658">658</a>             fits = <strong class="jxr_keyword">new</strong> Fits();
<a class="jxr_linenumber" name="L659" href="#L659">659</a>             fits.read(in);
<a class="jxr_linenumber" name="L660" href="#L660">660</a> 
<a class="jxr_linenumber" name="L661" href="#L661">661</a>             BasicHDU&lt;?&gt; hdu = fits.getHDU(0);
<a class="jxr_linenumber" name="L662" href="#L662">662</a>             Header hdr = hdu.getHeader();
<a class="jxr_linenumber" name="L663" href="#L663">663</a> 
<a class="jxr_linenumber" name="L664" href="#L664">664</a>             hdu.addValue(CTYPE1, <strong class="jxr_keyword">true</strong>);
<a class="jxr_linenumber" name="L665" href="#L665">665</a>             assertEquals(hdr.getBooleanValue(CTYPE1.name()), <strong class="jxr_keyword">true</strong>);
<a class="jxr_linenumber" name="L666" href="#L666">666</a>             assertEquals(hdr.getBooleanValue(CTYPE1), <strong class="jxr_keyword">true</strong>);
<a class="jxr_linenumber" name="L667" href="#L667">667</a> 
<a class="jxr_linenumber" name="L668" href="#L668">668</a>             hdu.addValue(CTYPE1.name(), false, <span class="jxr_string">"bla"</span>);
<a class="jxr_linenumber" name="L669" href="#L669">669</a>             assertEquals(hdr.getBooleanValue(CTYPE1.name()), false);
<a class="jxr_linenumber" name="L670" href="#L670">670</a>             assertEquals(hdr.getBooleanValue(CTYPE1), false);
<a class="jxr_linenumber" name="L671" href="#L671">671</a> 
<a class="jxr_linenumber" name="L672" href="#L672">672</a>             hdu.addValue(CTYPE1.name(), 5, <span class="jxr_string">"bla"</span>);
<a class="jxr_linenumber" name="L673" href="#L673">673</a>             assertEquals(hdr.getIntValue(CTYPE1.name()), 5);
<a class="jxr_linenumber" name="L674" href="#L674">674</a>             assertEquals(hdr.getIntValue(CTYPE1), 5);
<a class="jxr_linenumber" name="L675" href="#L675">675</a> 
<a class="jxr_linenumber" name="L676" href="#L676">676</a>             hdu.addValue(CTYPE1.name(), <span class="jxr_string">"XX"</span>, <span class="jxr_string">"bla"</span>);
<a class="jxr_linenumber" name="L677" href="#L677">677</a>             assertEquals(hdr.getStringValue(CTYPE1.name()), <span class="jxr_string">"XX"</span>);
<a class="jxr_linenumber" name="L678" href="#L678">678</a>             assertEquals(hdr.getStringValue(CTYPE1), <span class="jxr_string">"XX"</span>);
<a class="jxr_linenumber" name="L679" href="#L679">679</a> 
<a class="jxr_linenumber" name="L680" href="#L680">680</a>             hdr.addValue(CTYPE2, <strong class="jxr_keyword">true</strong>);
<a class="jxr_linenumber" name="L681" href="#L681">681</a>             assertEquals(hdr.getBooleanValue(CTYPE2.name()), <strong class="jxr_keyword">true</strong>);
<a class="jxr_linenumber" name="L682" href="#L682">682</a>             assertEquals(hdr.getBooleanValue(CTYPE2), <strong class="jxr_keyword">true</strong>);
<a class="jxr_linenumber" name="L683" href="#L683">683</a> 
<a class="jxr_linenumber" name="L684" href="#L684">684</a>             hdr.addValue(CTYPE2, 5.0);
<a class="jxr_linenumber" name="L685" href="#L685">685</a>             assertEquals(hdr.getDoubleValue(CTYPE2.name()), 5.0, 0.000001);
<a class="jxr_linenumber" name="L686" href="#L686">686</a>             assertEquals(hdr.getDoubleValue(CTYPE2), 5.0, 0.000001);
<a class="jxr_linenumber" name="L687" href="#L687">687</a> 
<a class="jxr_linenumber" name="L688" href="#L688">688</a>             hdr.addValue(CTYPE2.name(), BigDecimal.valueOf(5.0), <span class="jxr_string">"nothing special"</span>);
<a class="jxr_linenumber" name="L689" href="#L689">689</a>             assertEquals(hdr.getDoubleValue(CTYPE2.name()), 5.0, 0.000001);
<a class="jxr_linenumber" name="L690" href="#L690">690</a>             assertEquals(hdr.getDoubleValue(CTYPE2, -1d), 5.0, 0.000001);
<a class="jxr_linenumber" name="L691" href="#L691">691</a>             assertEquals(hdr.getDoubleValue(CTYPE2), 5.0, 0.000001);
<a class="jxr_linenumber" name="L692" href="#L692">692</a>             assertEquals(hdr.getBigDecimalValue(CTYPE2.name()), BigDecimal.valueOf(5.0));
<a class="jxr_linenumber" name="L693" href="#L693">693</a>             assertEquals(hdr.getBigDecimalValue(CTYPE2), BigDecimal.valueOf(5.0));
<a class="jxr_linenumber" name="L694" href="#L694">694</a> 
<a class="jxr_linenumber" name="L695" href="#L695">695</a>             hdr.addValue(CTYPE2.name(), 5.0f, <span class="jxr_string">"nothing special"</span>);
<a class="jxr_linenumber" name="L696" href="#L696">696</a>             assertEquals(hdr.getFloatValue(CTYPE2.name()), 5.0f, 0.000001);
<a class="jxr_linenumber" name="L697" href="#L697">697</a>             assertEquals(hdr.getFloatValue(CTYPE2), 5.0f, 0.000001);
<a class="jxr_linenumber" name="L698" href="#L698">698</a>             assertEquals(hdr.getFloatValue(CTYPE2.name(), -1f), 5.0f, 0.000001);
<a class="jxr_linenumber" name="L699" href="#L699">699</a>             assertEquals(hdr.getFloatValue(CTYPE2, -1f), 5.0f, 0.000001);
<a class="jxr_linenumber" name="L700" href="#L700">700</a> 
<a class="jxr_linenumber" name="L701" href="#L701">701</a>             hdr.addValue(CTYPE2.name(), BigInteger.valueOf(5), <span class="jxr_string">"nothing special"</span>);
<a class="jxr_linenumber" name="L702" href="#L702">702</a>             assertEquals(hdr.getIntValue(CTYPE2.name()), 5);
<a class="jxr_linenumber" name="L703" href="#L703">703</a>             assertEquals(hdr.getIntValue(CTYPE2), 5);
<a class="jxr_linenumber" name="L704" href="#L704">704</a>             assertEquals(hdr.getBigIntegerValue(CTYPE2.name()), BigInteger.valueOf(5));
<a class="jxr_linenumber" name="L705" href="#L705">705</a>             assertEquals(hdr.getBigIntegerValue(CTYPE2.name(), BigInteger.valueOf(-1)), BigInteger.valueOf(5));
<a class="jxr_linenumber" name="L706" href="#L706">706</a>             assertEquals(hdr.getBigIntegerValue(CTYPE2, BigInteger.valueOf(-1)), BigInteger.valueOf(5));
<a class="jxr_linenumber" name="L707" href="#L707">707</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L708" href="#L708">708</a>             SafeClose.close(in);
<a class="jxr_linenumber" name="L709" href="#L709">709</a>             SafeClose.close(fits);
<a class="jxr_linenumber" name="L710" href="#L710">710</a>         }
<a class="jxr_linenumber" name="L711" href="#L711">711</a>     }
<a class="jxr_linenumber" name="L712" href="#L712">712</a> 
<a class="jxr_linenumber" name="L713" href="#L713">713</a>     @Test
<a class="jxr_linenumber" name="L714" href="#L714">714</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> dumpHeaderTests() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L715" href="#L715">715</a>         Fits f = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L716" href="#L716">716</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L717" href="#L717">717</a>             f = <strong class="jxr_keyword">new</strong> Fits(<span class="jxr_string">"target/ht1.fits"</span>);
<a class="jxr_linenumber" name="L718" href="#L718">718</a>             BasicHDU&lt;?&gt; hdu = f.getHDU(0);
<a class="jxr_linenumber" name="L719" href="#L719">719</a>             Header hdr = hdu.getHeader();
<a class="jxr_linenumber" name="L720" href="#L720">720</a>             ByteArrayOutputStream out = <strong class="jxr_keyword">new</strong> ByteArrayOutputStream();
<a class="jxr_linenumber" name="L721" href="#L721">721</a>             hdr.dumpHeader(<strong class="jxr_keyword">new</strong> PrintStream(out));
<a class="jxr_linenumber" name="L722" href="#L722">722</a>             String result = <strong class="jxr_keyword">new</strong> String(out.toByteArray());
<a class="jxr_linenumber" name="L723" href="#L723">723</a>             assertTrue(result.indexOf(<span class="jxr_string">"NAXIS   =                    2"</span>) &gt;= 0);
<a class="jxr_linenumber" name="L724" href="#L724">724</a>             assertTrue(result.indexOf(<span class="jxr_string">"NAXIS1  =                  300"</span>) &gt;= 0);
<a class="jxr_linenumber" name="L725" href="#L725">725</a>             assertTrue(result.indexOf(<span class="jxr_string">"NAXIS2  =                  300"</span>) &gt;= 0);
<a class="jxr_linenumber" name="L726" href="#L726">726</a> 
<a class="jxr_linenumber" name="L727" href="#L727">727</a>             assertEquals(<span class="jxr_string">"NAXIS1  =                  300 / size of the n'th axis"</span>, hdr.findKey(<span class="jxr_string">"NAXIS1"</span>).trim());
<a class="jxr_linenumber" name="L728" href="#L728">728</a> 
<a class="jxr_linenumber" name="L729" href="#L729">729</a>             assertEquals(<span class="jxr_string">"SIMPLE"</span>, hdr.getKey(0));
<a class="jxr_linenumber" name="L730" href="#L730">730</a>             assertEquals(7, hdr.size());
<a class="jxr_linenumber" name="L731" href="#L731">731</a>             assertEquals(362880, hdu.getSize());
<a class="jxr_linenumber" name="L732" href="#L732">732</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L733" href="#L733">733</a>             SafeClose.close(f);
<a class="jxr_linenumber" name="L734" href="#L734">734</a>         }
<a class="jxr_linenumber" name="L735" href="#L735">735</a>     }
<a class="jxr_linenumber" name="L736" href="#L736">736</a> 
<a class="jxr_linenumber" name="L737" href="#L737">737</a>     @Test
<a class="jxr_linenumber" name="L738" href="#L738">738</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> dumpDefaultStatics() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L739" href="#L739">739</a>         assertFalse(BasicHDU.isData(<strong class="jxr_keyword">null</strong>));
<a class="jxr_linenumber" name="L740" href="#L740">740</a>         assertFalse(BasicHDU.isHeader(<strong class="jxr_keyword">null</strong>));
<a class="jxr_linenumber" name="L741" href="#L741">741</a>     }
<a class="jxr_linenumber" name="L742" href="#L742">742</a> 
<a class="jxr_linenumber" name="L743" href="#L743">743</a>     @Test
<a class="jxr_linenumber" name="L744" href="#L744">744</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> notExistentKeys() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L745" href="#L745">745</a>         Fits f = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L746" href="#L746">746</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L747" href="#L747">747</a>             f = <strong class="jxr_keyword">new</strong> Fits(<span class="jxr_string">"target/ht1.fits"</span>);
<a class="jxr_linenumber" name="L748" href="#L748">748</a>             Header hdr = f.getHDU(0).getHeader();
<a class="jxr_linenumber" name="L749" href="#L749">749</a>             Assert.assertNull(hdr.getCard(10000));
<a class="jxr_linenumber" name="L750" href="#L750">750</a>             Assert.assertNull(hdr.getKey(10000));
<a class="jxr_linenumber" name="L751" href="#L751">751</a>             Assert.assertNull(hdr.findKey(<span class="jxr_string">"BBBB"</span>));
<a class="jxr_linenumber" name="L752" href="#L752">752</a>             Assert.assertEquals(BigInteger.valueOf(-100), hdr.getBigIntegerValue(<span class="jxr_string">"BBBB"</span>, BigInteger.valueOf(-100)));
<a class="jxr_linenumber" name="L753" href="#L753">753</a>             Assert.assertEquals(-100f, hdr.getFloatValue(<span class="jxr_string">"BBBB"</span>, -100f), 0.00001);
<a class="jxr_linenumber" name="L754" href="#L754">754</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L755" href="#L755">755</a>             SafeClose.close(f);
<a class="jxr_linenumber" name="L756" href="#L756">756</a>         }
<a class="jxr_linenumber" name="L757" href="#L757">757</a>     }
<a class="jxr_linenumber" name="L758" href="#L758">758</a> 
<a class="jxr_linenumber" name="L759" href="#L759">759</a>     @Test
<a class="jxr_linenumber" name="L760" href="#L760">760</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> invalidHeader() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L761" href="#L761">761</a>         invalidHeaderTests();
<a class="jxr_linenumber" name="L762" href="#L762">762</a>     }
<a class="jxr_linenumber" name="L763" href="#L763">763</a> 
<a class="jxr_linenumber" name="L764" href="#L764">764</a>     @Test
<a class="jxr_linenumber" name="L765" href="#L765">765</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> headerFunktionsAndComments() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L766" href="#L766">766</a>         Header header = invalidHeaderTests();
<a class="jxr_linenumber" name="L767" href="#L767">767</a>         <em class="jxr_comment">// should have no effect because it is illegal!</em>
<a class="jxr_linenumber" name="L768" href="#L768">768</a>         header.setNaxis(-1, 3);
<a class="jxr_linenumber" name="L769" href="#L769">769</a>         Assert.assertEquals(1, header.getIntValue(NAXIS.name()));
<a class="jxr_linenumber" name="L770" href="#L770">770</a> 
<a class="jxr_linenumber" name="L771" href="#L771">771</a>         header.addLine(<strong class="jxr_keyword">new</strong> HeaderCard(<span class="jxr_string">"COMMENT"</span>, (String) <strong class="jxr_keyword">null</strong>, <span class="jxr_string">"bla bla"</span>));
<a class="jxr_linenumber" name="L772" href="#L772">772</a>         header.insertComment(<span class="jxr_string">"blu blu"</span>);
<a class="jxr_linenumber" name="L773" href="#L773">773</a>         header.addLine(<strong class="jxr_keyword">new</strong> HeaderCard(<span class="jxr_string">"HISTORY"</span>, (String) <strong class="jxr_keyword">null</strong>, <span class="jxr_string">"blab blab"</span>));
<a class="jxr_linenumber" name="L774" href="#L774">774</a>         header.insertHistory(<span class="jxr_string">"blub blub"</span>);
<a class="jxr_linenumber" name="L775" href="#L775">775</a>         Header header2 = <strong class="jxr_keyword">new</strong> Header();
<a class="jxr_linenumber" name="L776" href="#L776">776</a>         <strong class="jxr_keyword">boolean</strong> blaComment = false;
<a class="jxr_linenumber" name="L777" href="#L777">777</a>         <strong class="jxr_keyword">boolean</strong> bluComment = false;
<a class="jxr_linenumber" name="L778" href="#L778">778</a>         <strong class="jxr_keyword">boolean</strong> blabHistory = false;
<a class="jxr_linenumber" name="L779" href="#L779">779</a>         <strong class="jxr_keyword">boolean</strong> blubHistory = false;
<a class="jxr_linenumber" name="L780" href="#L780">780</a>         <strong class="jxr_keyword">boolean</strong> yzPressent = false;
<a class="jxr_linenumber" name="L781" href="#L781">781</a>         header2.updateLines(header);
<a class="jxr_linenumber" name="L782" href="#L782">782</a>         Cursor&lt;String, HeaderCard&gt; iter = header2.iterator();
<a class="jxr_linenumber" name="L783" href="#L783">783</a>         <strong class="jxr_keyword">while</strong> (iter.hasNext()) {
<a class="jxr_linenumber" name="L784" href="#L784">784</a>             HeaderCard headerCard = iter.next();
<a class="jxr_linenumber" name="L785" href="#L785">785</a>             blaComment = blaComment || headerCard.getComment().equals(<span class="jxr_string">"bla bla"</span>);
<a class="jxr_linenumber" name="L786" href="#L786">786</a>             bluComment = bluComment || headerCard.getComment().equals(<span class="jxr_string">"bla bla"</span>);
<a class="jxr_linenumber" name="L787" href="#L787">787</a>             blabHistory = blabHistory || headerCard.getComment().equals(<span class="jxr_string">"blab blab"</span>);
<a class="jxr_linenumber" name="L788" href="#L788">788</a>             blubHistory = blubHistory || headerCard.getComment().equals(<span class="jxr_string">"blub blub"</span>);
<a class="jxr_linenumber" name="L789" href="#L789">789</a>             yzPressent = yzPressent || headerCard.getKey().equals(<span class="jxr_string">"YZ"</span>);
<a class="jxr_linenumber" name="L790" href="#L790">790</a>         }
<a class="jxr_linenumber" name="L791" href="#L791">791</a>         assertTrue(blaComment);
<a class="jxr_linenumber" name="L792" href="#L792">792</a>         assertTrue(bluComment);
<a class="jxr_linenumber" name="L793" href="#L793">793</a>         assertTrue(blabHistory);
<a class="jxr_linenumber" name="L794" href="#L794">794</a>         assertTrue(blubHistory);
<a class="jxr_linenumber" name="L795" href="#L795">795</a>         assertTrue(yzPressent);
<a class="jxr_linenumber" name="L796" href="#L796">796</a>     }
<a class="jxr_linenumber" name="L797" href="#L797">797</a> 
<a class="jxr_linenumber" name="L798" href="#L798">798</a>     <strong class="jxr_keyword">private</strong> Header invalidHeaderTests() <strong class="jxr_keyword">throws</strong> HeaderCardException {
<a class="jxr_linenumber" name="L799" href="#L799">799</a>         Header header = <strong class="jxr_keyword">new</strong> Header();
<a class="jxr_linenumber" name="L800" href="#L800">800</a>         Assert.assertEquals(0, header.getSize());
<a class="jxr_linenumber" name="L801" href="#L801">801</a>         header.addValue(<span class="jxr_string">"XX"</span>, <span class="jxr_string">"XX"</span>, <span class="jxr_string">"XYZ"</span>);
<a class="jxr_linenumber" name="L802" href="#L802">802</a>         header.addValue(<span class="jxr_string">"XY"</span>, <span class="jxr_string">"XX"</span>, <span class="jxr_string">"XYZ"</span>);
<a class="jxr_linenumber" name="L803" href="#L803">803</a>         header.addValue(<span class="jxr_string">"XZ"</span>, <span class="jxr_string">"XX"</span>, <span class="jxr_string">"XYZ"</span>);
<a class="jxr_linenumber" name="L804" href="#L804">804</a>         header.addValue(<span class="jxr_string">"YZ"</span>, <span class="jxr_string">"XX"</span>, <span class="jxr_string">"XYZ"</span>);
<a class="jxr_linenumber" name="L805" href="#L805">805</a>         Assert.assertEquals(0, header.getSize());
<a class="jxr_linenumber" name="L806" href="#L806">806</a> 
<a class="jxr_linenumber" name="L807" href="#L807">807</a>         Cursor&lt;String, HeaderCard&gt; iterator = header.iterator(0);
<a class="jxr_linenumber" name="L808" href="#L808">808</a>         iterator.add(<strong class="jxr_keyword">new</strong> HeaderCard(SIMPLE.name(), <span class="jxr_string">""</span>, <span class="jxr_string">""</span>));
<a class="jxr_linenumber" name="L809" href="#L809">809</a>         Assert.assertEquals(0, header.getSize());
<a class="jxr_linenumber" name="L810" href="#L810">810</a>         iterator.add(<strong class="jxr_keyword">new</strong> HeaderCard(BITPIX.name(), 8, <span class="jxr_string">""</span>));
<a class="jxr_linenumber" name="L811" href="#L811">811</a>         Assert.assertEquals(0, header.getSize());
<a class="jxr_linenumber" name="L812" href="#L812">812</a>         iterator.add(<strong class="jxr_keyword">new</strong> HeaderCard(NAXIS.name(), 1, <span class="jxr_string">""</span>));
<a class="jxr_linenumber" name="L813" href="#L813">813</a>         Assert.assertEquals(0, header.getSize());
<a class="jxr_linenumber" name="L814" href="#L814">814</a>         header.addValue(<span class="jxr_string">"END"</span>, <span class="jxr_string">""</span>, <span class="jxr_string">""</span>);
<a class="jxr_linenumber" name="L815" href="#L815">815</a>         Assert.assertEquals(2880, header.getSize());
<a class="jxr_linenumber" name="L816" href="#L816">816</a>         <strong class="jxr_keyword">return</strong> header;
<a class="jxr_linenumber" name="L817" href="#L817">817</a>     }
<a class="jxr_linenumber" name="L818" href="#L818">818</a> 
<a class="jxr_linenumber" name="L819" href="#L819">819</a>     @Test
<a class="jxr_linenumber" name="L820" href="#L820">820</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> testSpecialSituations() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L821" href="#L821">821</a>         Header header = <strong class="jxr_keyword">new</strong> Header();
<a class="jxr_linenumber" name="L822" href="#L822">822</a>         assertNull(header.nextCard());
<a class="jxr_linenumber" name="L823" href="#L823">823</a>         assertNull(header.getCard(-1));
<a class="jxr_linenumber" name="L824" href="#L824">824</a> 
<a class="jxr_linenumber" name="L825" href="#L825">825</a>         BufferedDataOutputStream out = <strong class="jxr_keyword">new</strong> BufferedDataOutputStream(<strong class="jxr_keyword">new</strong> ByteArrayOutputStream());
<a class="jxr_linenumber" name="L826" href="#L826">826</a>         FitsException actual = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L827" href="#L827">827</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L828" href="#L828">828</a>             header.write(out);
<a class="jxr_linenumber" name="L829" href="#L829">829</a>         } <strong class="jxr_keyword">catch</strong> (FitsException e) {
<a class="jxr_linenumber" name="L830" href="#L830">830</a>             actual = e;
<a class="jxr_linenumber" name="L831" href="#L831">831</a>         }
<a class="jxr_linenumber" name="L832" href="#L832">832</a>         header.addValue(<span class="jxr_string">"DUMMY"</span>, false, <span class="jxr_string">""</span>);
<a class="jxr_linenumber" name="L833" href="#L833">833</a>         actual = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L834" href="#L834">834</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L835" href="#L835">835</a>             header.write(out);
<a class="jxr_linenumber" name="L836" href="#L836">836</a>         } <strong class="jxr_keyword">catch</strong> (FitsException e) {
<a class="jxr_linenumber" name="L837" href="#L837">837</a>             actual = e;
<a class="jxr_linenumber" name="L838" href="#L838">838</a>         }
<a class="jxr_linenumber" name="L839" href="#L839">839</a>         assertNotNull(actual);
<a class="jxr_linenumber" name="L840" href="#L840">840</a>         assertTrue(actual.getMessage().indexOf(<span class="jxr_string">"SIMPLE"</span>) &gt; 0);
<a class="jxr_linenumber" name="L841" href="#L841">841</a>         header.addValue(<span class="jxr_string">"XTENSION"</span>, <span class="jxr_string">""</span>, <span class="jxr_string">""</span>);
<a class="jxr_linenumber" name="L842" href="#L842">842</a>         actual = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L843" href="#L843">843</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L844" href="#L844">844</a>             header.write(out);
<a class="jxr_linenumber" name="L845" href="#L845">845</a>         } <strong class="jxr_keyword">catch</strong> (FitsException e) {
<a class="jxr_linenumber" name="L846" href="#L846">846</a>             actual = e;
<a class="jxr_linenumber" name="L847" href="#L847">847</a>         }
<a class="jxr_linenumber" name="L848" href="#L848">848</a>         assertNotNull(actual);
<a class="jxr_linenumber" name="L849" href="#L849">849</a>         assertTrue(actual.getMessage().indexOf(<span class="jxr_string">"XTENSION"</span>) &gt; 0);
<a class="jxr_linenumber" name="L850" href="#L850">850</a>         header.findCard(XTENSION.key()).setValue(XTENSION_BINTABLE);
<a class="jxr_linenumber" name="L851" href="#L851">851</a>         actual = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L852" href="#L852">852</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L853" href="#L853">853</a>             header.write(out);
<a class="jxr_linenumber" name="L854" href="#L854">854</a>         } <strong class="jxr_keyword">catch</strong> (FitsException e) {
<a class="jxr_linenumber" name="L855" href="#L855">855</a>             actual = e;
<a class="jxr_linenumber" name="L856" href="#L856">856</a>         }
<a class="jxr_linenumber" name="L857" href="#L857">857</a>         assertNotNull(actual);
<a class="jxr_linenumber" name="L858" href="#L858">858</a> 
<a class="jxr_linenumber" name="L859" href="#L859">859</a>         assertTrue(actual.getMessage().indexOf(<span class="jxr_string">"not found where expected"</span>) &gt; 0);
<a class="jxr_linenumber" name="L860" href="#L860">860</a> 
<a class="jxr_linenumber" name="L861" href="#L861">861</a>         header.removeCard(<span class="jxr_string">"DUMMY"</span>);
<a class="jxr_linenumber" name="L862" href="#L862">862</a> 
<a class="jxr_linenumber" name="L863" href="#L863">863</a>         actual = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L864" href="#L864">864</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L865" href="#L865">865</a>             header.write(out);
<a class="jxr_linenumber" name="L866" href="#L866">866</a>         } <strong class="jxr_keyword">catch</strong> (FitsException e) {
<a class="jxr_linenumber" name="L867" href="#L867">867</a>             actual = e;
<a class="jxr_linenumber" name="L868" href="#L868">868</a>         }
<a class="jxr_linenumber" name="L869" href="#L869">869</a>         assertNotNull(actual);
<a class="jxr_linenumber" name="L870" href="#L870">870</a> 
<a class="jxr_linenumber" name="L871" href="#L871">871</a>         assertTrue(actual.getMessage().indexOf(<span class="jxr_string">"terminates before"</span>) &gt; 0);
<a class="jxr_linenumber" name="L872" href="#L872">872</a>     }
<a class="jxr_linenumber" name="L873" href="#L873">873</a> 
<a class="jxr_linenumber" name="L874" href="#L874">874</a>     @Test
<a class="jxr_linenumber" name="L875" href="#L875">875</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> testHierarchLongStringIssue44() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L876" href="#L876">876</a>         <strong class="jxr_keyword">boolean</strong> useHierarch = FitsFactory.getUseHierarch();
<a class="jxr_linenumber" name="L877" href="#L877">877</a>         <strong class="jxr_keyword">boolean</strong> longStringsEnabled = FitsFactory.isLongStringsEnabled();
<a class="jxr_linenumber" name="L878" href="#L878">878</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L879" href="#L879">879</a>             String filename = <span class="jxr_string">"target/testHierarchLongString.fits"</span>;
<a class="jxr_linenumber" name="L880" href="#L880">880</a>             FitsFactory.setUseHierarch(<strong class="jxr_keyword">true</strong>);
<a class="jxr_linenumber" name="L881" href="#L881">881</a>             FitsFactory.setLongStringsEnabled(<strong class="jxr_keyword">true</strong>);
<a class="jxr_linenumber" name="L882" href="#L882">882</a> 
<a class="jxr_linenumber" name="L883" href="#L883">883</a>             Fits f = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L884" href="#L884">884</a>             <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L885" href="#L885">885</a>                 f = <strong class="jxr_keyword">new</strong> Fits();
<a class="jxr_linenumber" name="L886" href="#L886">886</a>                 BasicHDU&lt;?&gt; primaryHdu = FitsFactory.hduFactory(<strong class="jxr_keyword">new</strong> <strong class="jxr_keyword">float</strong>[0]);
<a class="jxr_linenumber" name="L887" href="#L887">887</a> 
<a class="jxr_linenumber" name="L888" href="#L888">888</a>                 primaryHdu.getHeader().addValue(<span class="jxr_string">"HIERARCH.TEST.THIS.LONG.HEADER"</span>, <span class="jxr_string">"aaaaaaaabbbbbbbbbcccccccccccdddddddddddeeeeeeeeeee"</span>, <span class="jxr_string">""</span>);
<a class="jxr_linenumber" name="L889" href="#L889">889</a> 
<a class="jxr_linenumber" name="L890" href="#L890">890</a>                 <strong class="jxr_keyword">for</strong> (<strong class="jxr_keyword">int</strong> index = 1; index &lt; 60; index++) {
<a class="jxr_linenumber" name="L891" href="#L891">891</a>                     StringBuilder buildder = <strong class="jxr_keyword">new</strong> StringBuilder();
<a class="jxr_linenumber" name="L892" href="#L892">892</a>                     <strong class="jxr_keyword">for</strong> (<strong class="jxr_keyword">int</strong> charIndex = 0; charIndex &lt; index; charIndex++) {
<a class="jxr_linenumber" name="L893" href="#L893">893</a>                         buildder.append((<strong class="jxr_keyword">char</strong>) ('A' + (charIndex % 26)));
<a class="jxr_linenumber" name="L894" href="#L894">894</a>                     }
<a class="jxr_linenumber" name="L895" href="#L895">895</a>                     primaryHdu.getHeader().addValue(<span class="jxr_string">"HIERARCH.X"</span> + buildder.toString(), <span class="jxr_string">"_!_!_!_!_!_!_!_!_!_!_!_!_!_!_!_!_!"</span>, buildder.toString());
<a class="jxr_linenumber" name="L896" href="#L896">896</a>                 }
<a class="jxr_linenumber" name="L897" href="#L897">897</a> 
<a class="jxr_linenumber" name="L898" href="#L898">898</a>                 f.addHDU(primaryHdu);
<a class="jxr_linenumber" name="L899" href="#L899">899</a>                 BufferedFile bf = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L900" href="#L900">900</a>                 <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L901" href="#L901">901</a>                     bf = <strong class="jxr_keyword">new</strong> BufferedFile(filename, <span class="jxr_string">"rw"</span>);
<a class="jxr_linenumber" name="L902" href="#L902">902</a>                     f.write(bf);
<a class="jxr_linenumber" name="L903" href="#L903">903</a>                 } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L904" href="#L904">904</a>                     SafeClose.close(bf);
<a class="jxr_linenumber" name="L905" href="#L905">905</a>                 }
<a class="jxr_linenumber" name="L906" href="#L906">906</a>             } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L907" href="#L907">907</a>                 SafeClose.close(f);
<a class="jxr_linenumber" name="L908" href="#L908">908</a>             }
<a class="jxr_linenumber" name="L909" href="#L909">909</a> 
<a class="jxr_linenumber" name="L910" href="#L910">910</a>             <em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="L911" href="#L911">911</a> <em class="jxr_comment">             * This will fail ...</em>
<a class="jxr_linenumber" name="L912" href="#L912">912</a> <em class="jxr_comment">             */</em>
<a class="jxr_linenumber" name="L913" href="#L913">913</a>             <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L914" href="#L914">914</a>                 f = <strong class="jxr_keyword">new</strong> Fits(filename);
<a class="jxr_linenumber" name="L915" href="#L915">915</a>                 Header headerRewriter = f.getHDU(0).getHeader();
<a class="jxr_linenumber" name="L916" href="#L916">916</a>                 assertEquals(<span class="jxr_string">"aaaaaaaabbbbbbbbbcccccccccccdddddddddddeeeeeeeeeee"</span>, headerRewriter.findCard(<span class="jxr_string">"HIERARCH.TEST.THIS.LONG.HEADER"</span>).getValue());
<a class="jxr_linenumber" name="L917" href="#L917">917</a>                 <strong class="jxr_keyword">for</strong> (<strong class="jxr_keyword">int</strong> index = 1; index &lt; 60; index++) {
<a class="jxr_linenumber" name="L918" href="#L918">918</a>                     StringBuilder buildder = <strong class="jxr_keyword">new</strong> StringBuilder();
<a class="jxr_linenumber" name="L919" href="#L919">919</a>                     <strong class="jxr_keyword">for</strong> (<strong class="jxr_keyword">int</strong> charIndex = 0; charIndex &lt; index; charIndex++) {
<a class="jxr_linenumber" name="L920" href="#L920">920</a>                         buildder.append((<strong class="jxr_keyword">char</strong>) ('A' + (charIndex % 26)));
<a class="jxr_linenumber" name="L921" href="#L921">921</a>                     }
<a class="jxr_linenumber" name="L922" href="#L922">922</a>                     HeaderCard card = headerRewriter.findCard(<span class="jxr_string">"HIERARCH.X"</span> + buildder.toString());
<a class="jxr_linenumber" name="L923" href="#L923">923</a>                     assertEquals(<span class="jxr_string">"_!_!_!_!_!_!_!_!_!_!_!_!_!_!_!_!_!"</span>, card.getValue());
<a class="jxr_linenumber" name="L924" href="#L924">924</a>                     <strong class="jxr_keyword">if</strong> (card.getComment() != <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="L925" href="#L925">925</a>                         assertTrue(buildder.toString().startsWith(card.getComment()));
<a class="jxr_linenumber" name="L926" href="#L926">926</a>                     }
<a class="jxr_linenumber" name="L927" href="#L927">927</a>                 }
<a class="jxr_linenumber" name="L928" href="#L928">928</a>             } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L929" href="#L929">929</a>                 SafeClose.close(f);
<a class="jxr_linenumber" name="L930" href="#L930">930</a>             }
<a class="jxr_linenumber" name="L931" href="#L931">931</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L932" href="#L932">932</a>             FitsFactory.setUseHierarch(useHierarch);
<a class="jxr_linenumber" name="L933" href="#L933">933</a>             FitsFactory.setLongStringsEnabled(longStringsEnabled);
<a class="jxr_linenumber" name="L934" href="#L934">934</a>         }
<a class="jxr_linenumber" name="L935" href="#L935">935</a>     }
<a class="jxr_linenumber" name="L936" href="#L936">936</a> 
<a class="jxr_linenumber" name="L937" href="#L937">937</a>     @Test
<a class="jxr_linenumber" name="L938" href="#L938">938</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> testTrimBlanksAfterQuotedString() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L939" href="#L939">939</a>         String card = <span class="jxr_string">"TESTTEST= 'TESTVALUE ''QUOTED'' TRIMMSTUFF     '  / comment"</span>;
<a class="jxr_linenumber" name="L940" href="#L940">940</a> 
<a class="jxr_linenumber" name="L941" href="#L941">941</a>         ParsedValue parsedValue = FitsHeaderCardParser.parseCardValue(card);
<a class="jxr_linenumber" name="L942" href="#L942">942</a>         assertEquals(<span class="jxr_string">"comment"</span>, parsedValue.getComment());
<a class="jxr_linenumber" name="L943" href="#L943">943</a>         <em class="jxr_comment">// lets see if the blanks after the value are removed.</em>
<a class="jxr_linenumber" name="L944" href="#L944">944</a>         assertEquals(<span class="jxr_string">"TESTVALUE 'QUOTED' TRIMMSTUFF"</span>, parsedValue.getValue());
<a class="jxr_linenumber" name="L945" href="#L945">945</a> 
<a class="jxr_linenumber" name="L946" href="#L946">946</a>     }
<a class="jxr_linenumber" name="L947" href="#L947">947</a> 
<a class="jxr_linenumber" name="L948" href="#L948">948</a>     @Test(expected = FitsException.<strong class="jxr_keyword">class</strong>)
<a class="jxr_linenumber" name="L949" href="#L949">949</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> writeEmptyHeader() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L950" href="#L950">950</a>         ArrayDataOutput dos = <strong class="jxr_keyword">new</strong> BufferedDataOutputStream(<strong class="jxr_keyword">new</strong> ByteArrayOutputStream() {
<a class="jxr_linenumber" name="L951" href="#L951">951</a> 
<a class="jxr_linenumber" name="L952" href="#L952">952</a>             @Override
<a class="jxr_linenumber" name="L953" href="#L953">953</a>             <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">synchronized</strong> <strong class="jxr_keyword">void</strong> write(byte[] b, <strong class="jxr_keyword">int</strong> off, <strong class="jxr_keyword">int</strong> len) {
<a class="jxr_linenumber" name="L954" href="#L954">954</a>                 ThrowAnyException.throwIOException(<span class="jxr_string">"all goes wrong!"</span>);
<a class="jxr_linenumber" name="L955" href="#L955">955</a>             }
<a class="jxr_linenumber" name="L956" href="#L956">956</a>         }, 80);
<a class="jxr_linenumber" name="L957" href="#L957">957</a>         Header header = <strong class="jxr_keyword">new</strong> Header();
<a class="jxr_linenumber" name="L958" href="#L958">958</a>         header.addValue(SIMPLE, <strong class="jxr_keyword">true</strong>);
<a class="jxr_linenumber" name="L959" href="#L959">959</a>         header.addValue(BITPIX, 1);
<a class="jxr_linenumber" name="L960" href="#L960">960</a>         header.addValue(NAXIS, 0);
<a class="jxr_linenumber" name="L961" href="#L961">961</a>         header.addValue(END, <strong class="jxr_keyword">true</strong>);
<a class="jxr_linenumber" name="L962" href="#L962">962</a> 
<a class="jxr_linenumber" name="L963" href="#L963">963</a>         header.write(dos);
<a class="jxr_linenumber" name="L964" href="#L964">964</a>     }
<a class="jxr_linenumber" name="L965" href="#L965">965</a> 
<a class="jxr_linenumber" name="L966" href="#L966">966</a>     <em class="jxr_javadoccomment">/** Truncate header test. */</em>
<a class="jxr_linenumber" name="L967" href="#L967">967</a>     @Test(expected = TruncatedFileException.<strong class="jxr_keyword">class</strong>)
<a class="jxr_linenumber" name="L968" href="#L968">968</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> truncatedFileExceptionTest() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L969" href="#L969">969</a>         FileInputStream f = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L970" href="#L970">970</a>         FileOutputStream out = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L971" href="#L971">971</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L972" href="#L972">972</a>             f = <strong class="jxr_keyword">new</strong> FileInputStream(<span class="jxr_string">"target/ht1.fits"</span>);<em class="jxr_comment">//</em>
<a class="jxr_linenumber" name="L973" href="#L973">973</a>             out = <strong class="jxr_keyword">new</strong> FileOutputStream(<span class="jxr_string">"target/ht1_truncated.fits"</span>);
<a class="jxr_linenumber" name="L974" href="#L974">974</a>             byte[] buffer = <strong class="jxr_keyword">new</strong> byte[1024];
<a class="jxr_linenumber" name="L975" href="#L975">975</a>             <strong class="jxr_keyword">int</strong> count = f.read(buffer);
<a class="jxr_linenumber" name="L976" href="#L976">976</a>             out.write(buffer, 0, count);
<a class="jxr_linenumber" name="L977" href="#L977">977</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L978" href="#L978">978</a>             SafeClose.close(out);
<a class="jxr_linenumber" name="L979" href="#L979">979</a>             SafeClose.close(f);
<a class="jxr_linenumber" name="L980" href="#L980">980</a>         }
<a class="jxr_linenumber" name="L981" href="#L981">981</a>         Fits fits = <strong class="jxr_keyword">null</strong>;
<a class="jxr_linenumber" name="L982" href="#L982">982</a>         <strong class="jxr_keyword">try</strong> {
<a class="jxr_linenumber" name="L983" href="#L983">983</a>             fits = <strong class="jxr_keyword">new</strong> Fits(<span class="jxr_string">"target/ht1_truncated.fits"</span>);
<a class="jxr_linenumber" name="L984" href="#L984">984</a>             ImageHDU hdu = (ImageHDU) fits.getHDU(0);
<a class="jxr_linenumber" name="L985" href="#L985">985</a>             Header hdr = hdu.getHeader();
<a class="jxr_linenumber" name="L986" href="#L986">986</a>         } <strong class="jxr_keyword">finally</strong> {
<a class="jxr_linenumber" name="L987" href="#L987">987</a>             SafeClose.close(fits);
<a class="jxr_linenumber" name="L988" href="#L988">988</a>         }
<a class="jxr_linenumber" name="L989" href="#L989">989</a>     }
<a class="jxr_linenumber" name="L990" href="#L990">990</a> 
<a class="jxr_linenumber" name="L991" href="#L991">991</a>     @Test(expected = IOException.<strong class="jxr_keyword">class</strong>)
<a class="jxr_linenumber" name="L992" href="#L992">992</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> truncatedFileExceptionTest2() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L993" href="#L993">993</a>         String header = <span class="jxr_string">"SIMPLE                                                                          "</span> + <em class="jxr_comment">//</em>
<a class="jxr_linenumber" name="L994" href="#L994">994</a>                 <span class="jxr_string">"XXXXXX                                                                          "</span>;
<a class="jxr_linenumber" name="L995" href="#L995">995</a>         BufferedDataInputStream data = <strong class="jxr_keyword">new</strong> BufferedDataInputStream(<strong class="jxr_keyword">new</strong> ByteArrayInputStream(AsciiFuncs.getBytes(header)));
<a class="jxr_linenumber" name="L996" href="#L996">996</a>         <strong class="jxr_keyword">new</strong> Header().read(data);
<a class="jxr_linenumber" name="L997" href="#L997">997</a>     }
<a class="jxr_linenumber" name="L998" href="#L998">998</a> 
<a class="jxr_linenumber" name="L999" href="#L999">999</a>     @Test
<a class="jxr_linenumber" name="L1000" href="#L1000">1000</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> testFailedReset() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L1001" href="#L1001">1001</a>         Assert.assertFalse(<strong class="jxr_keyword">new</strong> Header().reset());
<a class="jxr_linenumber" name="L1002" href="#L1002">1002</a>     }
<a class="jxr_linenumber" name="L1003" href="#L1003">1003</a> 
<a class="jxr_linenumber" name="L1004" href="#L1004">1004</a>     @Test(expected = FitsException.<strong class="jxr_keyword">class</strong>)
<a class="jxr_linenumber" name="L1005" href="#L1005">1005</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> testFailedRewrite() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L1006" href="#L1006">1006</a>         <strong class="jxr_keyword">new</strong> Header().rewrite();
<a class="jxr_linenumber" name="L1007" href="#L1007">1007</a>     }
<a class="jxr_linenumber" name="L1008" href="#L1008">1008</a> 
<a class="jxr_linenumber" name="L1009" href="#L1009">1009</a>     @Test
<a class="jxr_linenumber" name="L1010" href="#L1010">1010</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> testSetSimpleWithAxis() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L1011" href="#L1011">1011</a>         Header header = <strong class="jxr_keyword">new</strong> Header();
<a class="jxr_linenumber" name="L1012" href="#L1012">1012</a>         header.setNaxes(1);
<a class="jxr_linenumber" name="L1013" href="#L1013">1013</a>         header.setNaxis(1, 2);
<a class="jxr_linenumber" name="L1014" href="#L1014">1014</a>         header.setSimple(<strong class="jxr_keyword">true</strong>);
<a class="jxr_linenumber" name="L1015" href="#L1015">1015</a>         assertEquals(<span class="jxr_string">"T"</span>, header.findCard(SIMPLE).getValue());
<a class="jxr_linenumber" name="L1016" href="#L1016">1016</a>         assertEquals(<span class="jxr_string">"T"</span>, header.findCard(EXTEND).getValue());
<a class="jxr_linenumber" name="L1017" href="#L1017">1017</a>     }
<a class="jxr_linenumber" name="L1018" href="#L1018">1018</a> 
<a class="jxr_linenumber" name="L1019" href="#L1019">1019</a>     @Test
<a class="jxr_linenumber" name="L1020" href="#L1020">1020</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> testSpecialHeaderOrder() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L1021" href="#L1021">1021</a> 
<a class="jxr_linenumber" name="L1022" href="#L1022">1022</a>         Header hdr = <strong class="jxr_keyword">new</strong> Header();
<a class="jxr_linenumber" name="L1023" href="#L1023">1023</a>         hdr.addValue(<span class="jxr_string">"SIMPLE"</span>, <strong class="jxr_keyword">true</strong>, <span class="jxr_string">"Standard FITS format"</span>);
<a class="jxr_linenumber" name="L1024" href="#L1024">1024</a>         hdr.addValue(<span class="jxr_string">"BITPIX"</span>, 8, <span class="jxr_string">"Character data"</span>);
<a class="jxr_linenumber" name="L1025" href="#L1025">1025</a>         hdr.addValue(<span class="jxr_string">"NAXIS"</span>, 1, <span class="jxr_string">"Text string"</span>);
<a class="jxr_linenumber" name="L1026" href="#L1026">1026</a>         hdr.addValue(<span class="jxr_string">"NAXIS1"</span>, 1000, <span class="jxr_string">"Number of characters"</span>);
<a class="jxr_linenumber" name="L1027" href="#L1027">1027</a>         hdr.addValue(<span class="jxr_string">"VOTMETA"</span>, <strong class="jxr_keyword">true</strong>, <span class="jxr_string">"Table metadata in VOTable format"</span>);
<a class="jxr_linenumber" name="L1028" href="#L1028">1028</a>         hdr.addValue(<span class="jxr_string">"EXTEND"</span>, <strong class="jxr_keyword">true</strong>, <span class="jxr_string">"There are standard extensions"</span>);
<a class="jxr_linenumber" name="L1029" href="#L1029">1029</a>         <em class="jxr_comment">// ...</em>
<a class="jxr_linenumber" name="L1030" href="#L1030">1030</a>         BufferedDataOutputStream out = <strong class="jxr_keyword">new</strong> BufferedDataOutputStream(<strong class="jxr_keyword">new</strong> ByteArrayOutputStream());
<a class="jxr_linenumber" name="L1031" href="#L1031">1031</a>         hdr.write(out);
<a class="jxr_linenumber" name="L1032" href="#L1032">1032</a>         <strong class="jxr_keyword">int</strong> votMetaIndex = -1;
<a class="jxr_linenumber" name="L1033" href="#L1033">1033</a>         <strong class="jxr_keyword">int</strong> extendIndex = -1;
<a class="jxr_linenumber" name="L1034" href="#L1034">1034</a>         Cursor&lt;String, HeaderCard&gt; iterator = hdr.iterator();
<a class="jxr_linenumber" name="L1035" href="#L1035">1035</a>         <strong class="jxr_keyword">for</strong> (<strong class="jxr_keyword">int</strong> index = 0; iterator.hasNext(); index++) {
<a class="jxr_linenumber" name="L1036" href="#L1036">1036</a>             HeaderCard card = iterator.next();
<a class="jxr_linenumber" name="L1037" href="#L1037">1037</a>             <strong class="jxr_keyword">if</strong> (card.getKey().equals(<span class="jxr_string">"VOTMETA"</span>)) {
<a class="jxr_linenumber" name="L1038" href="#L1038">1038</a>                 votMetaIndex = index;
<a class="jxr_linenumber" name="L1039" href="#L1039">1039</a>             }
<a class="jxr_linenumber" name="L1040" href="#L1040">1040</a>             <strong class="jxr_keyword">if</strong> (card.getKey().equals(<span class="jxr_string">"EXTEND"</span>)) {
<a class="jxr_linenumber" name="L1041" href="#L1041">1041</a>                 extendIndex = index;
<a class="jxr_linenumber" name="L1042" href="#L1042">1042</a>             }
<a class="jxr_linenumber" name="L1043" href="#L1043">1043</a>         }
<a class="jxr_linenumber" name="L1044" href="#L1044">1044</a>         Assert.assertTrue(votMetaIndex &gt; extendIndex);
<a class="jxr_linenumber" name="L1045" href="#L1045">1045</a>         hdr.setHeaderSorter(<strong class="jxr_keyword">new</strong> HeaderOrder() {
<a class="jxr_linenumber" name="L1046" href="#L1046">1046</a> 
<a class="jxr_linenumber" name="L1047" href="#L1047">1047</a>             <strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> <strong class="jxr_keyword">long</strong> serialVersionUID = 1L;
<a class="jxr_linenumber" name="L1048" href="#L1048">1048</a> 
<a class="jxr_linenumber" name="L1049" href="#L1049">1049</a>             @Override
<a class="jxr_linenumber" name="L1050" href="#L1050">1050</a>             <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">int</strong> compare(String c1, String c2) {
<a class="jxr_linenumber" name="L1051" href="#L1051">1051</a>                 <strong class="jxr_keyword">int</strong> result = <strong class="jxr_keyword">super</strong>.compare(c1, c2);
<a class="jxr_linenumber" name="L1052" href="#L1052">1052</a>                 <strong class="jxr_keyword">if</strong> (c1.equals(<span class="jxr_string">"VOTMETA"</span>)) {
<a class="jxr_linenumber" name="L1053" href="#L1053">1053</a>                     <strong class="jxr_keyword">return</strong> c2.equals(Standard.EXTEND.key()) ? -1 : 1;
<a class="jxr_linenumber" name="L1054" href="#L1054">1054</a>                 } <strong class="jxr_keyword">else</strong> <strong class="jxr_keyword">if</strong> (c2.equals(<span class="jxr_string">"VOTMETA"</span>)) {
<a class="jxr_linenumber" name="L1055" href="#L1055">1055</a>                     <strong class="jxr_keyword">return</strong> c1.equals(Standard.EXTEND.key()) ? 1 : -1;
<a class="jxr_linenumber" name="L1056" href="#L1056">1056</a>                 }
<a class="jxr_linenumber" name="L1057" href="#L1057">1057</a>                 <strong class="jxr_keyword">return</strong> result;
<a class="jxr_linenumber" name="L1058" href="#L1058">1058</a>             }
<a class="jxr_linenumber" name="L1059" href="#L1059">1059</a>         });
<a class="jxr_linenumber" name="L1060" href="#L1060">1060</a>         hdr.write(out);
<a class="jxr_linenumber" name="L1061" href="#L1061">1061</a>         votMetaIndex = -1;
<a class="jxr_linenumber" name="L1062" href="#L1062">1062</a>         extendIndex = -1;
<a class="jxr_linenumber" name="L1063" href="#L1063">1063</a>         iterator = hdr.iterator();
<a class="jxr_linenumber" name="L1064" href="#L1064">1064</a>         <strong class="jxr_keyword">for</strong> (<strong class="jxr_keyword">int</strong> index = 0; iterator.hasNext(); index++) {
<a class="jxr_linenumber" name="L1065" href="#L1065">1065</a>             HeaderCard card = iterator.next();
<a class="jxr_linenumber" name="L1066" href="#L1066">1066</a>             <strong class="jxr_keyword">if</strong> (card.getKey().equals(<span class="jxr_string">"VOTMETA"</span>)) {
<a class="jxr_linenumber" name="L1067" href="#L1067">1067</a>                 votMetaIndex = index;
<a class="jxr_linenumber" name="L1068" href="#L1068">1068</a>             }
<a class="jxr_linenumber" name="L1069" href="#L1069">1069</a>             <strong class="jxr_keyword">if</strong> (card.getKey().equals(<span class="jxr_string">"EXTEND"</span>)) {
<a class="jxr_linenumber" name="L1070" href="#L1070">1070</a>                 extendIndex = index;
<a class="jxr_linenumber" name="L1071" href="#L1071">1071</a>             }
<a class="jxr_linenumber" name="L1072" href="#L1072">1072</a>         }
<a class="jxr_linenumber" name="L1073" href="#L1073">1073</a>         Assert.assertTrue(votMetaIndex &lt; extendIndex);
<a class="jxr_linenumber" name="L1074" href="#L1074">1074</a> 
<a class="jxr_linenumber" name="L1075" href="#L1075">1075</a>     }
<a class="jxr_linenumber" name="L1076" href="#L1076">1076</a> 
<a class="jxr_linenumber" name="L1077" href="#L1077">1077</a>     @Test
<a class="jxr_linenumber" name="L1078" href="#L1078">1078</a>     <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> testSpecialHeaderOrderNull() <strong class="jxr_keyword">throws</strong> Exception {
<a class="jxr_linenumber" name="L1079" href="#L1079">1079</a> 
<a class="jxr_linenumber" name="L1080" href="#L1080">1080</a>         Header hdr = <strong class="jxr_keyword">new</strong> Header();
<a class="jxr_linenumber" name="L1081" href="#L1081">1081</a>         hdr.setHeaderSorter(<strong class="jxr_keyword">null</strong>);
<a class="jxr_linenumber" name="L1082" href="#L1082">1082</a>         hdr.addValue(<span class="jxr_string">"SIMPLE"</span>, <strong class="jxr_keyword">true</strong>, <span class="jxr_string">"Standard FITS format"</span>);
<a class="jxr_linenumber" name="L1083" href="#L1083">1083</a>         hdr.addValue(<span class="jxr_string">"BITPIX"</span>, 8, <span class="jxr_string">"Character data"</span>);
<a class="jxr_linenumber" name="L1084" href="#L1084">1084</a>         hdr.addValue(<span class="jxr_string">"NAXIS"</span>, 1, <span class="jxr_string">"Text string"</span>);
<a class="jxr_linenumber" name="L1085" href="#L1085">1085</a>         hdr.addValue(<span class="jxr_string">"NAXIS1"</span>, 1000, <span class="jxr_string">"Number of characters"</span>);
<a class="jxr_linenumber" name="L1086" href="#L1086">1086</a>         hdr.addValue(<span class="jxr_string">"VOTMETA"</span>, <strong class="jxr_keyword">true</strong>, <span class="jxr_string">"Table metadata in VOTable format"</span>);
<a class="jxr_linenumber" name="L1087" href="#L1087">1087</a>         hdr.addValue(<span class="jxr_string">"EXTEND"</span>, <strong class="jxr_keyword">true</strong>, <span class="jxr_string">"There are standard extensions"</span>);
<a class="jxr_linenumber" name="L1088" href="#L1088">1088</a>         <em class="jxr_comment">// ...</em>
<a class="jxr_linenumber" name="L1089" href="#L1089">1089</a>         BufferedDataOutputStream out = <strong class="jxr_keyword">new</strong> BufferedDataOutputStream(<strong class="jxr_keyword">new</strong> ByteArrayOutputStream());
<a class="jxr_linenumber" name="L1090" href="#L1090">1090</a>         hdr.write(out);
<a class="jxr_linenumber" name="L1091" href="#L1091">1091</a>         <strong class="jxr_keyword">int</strong> votMetaIndex = -1;
<a class="jxr_linenumber" name="L1092" href="#L1092">1092</a>         <strong class="jxr_keyword">int</strong> extendIndex = -1;
<a class="jxr_linenumber" name="L1093" href="#L1093">1093</a>         Cursor&lt;String, HeaderCard&gt; iterator = hdr.iterator();
<a class="jxr_linenumber" name="L1094" href="#L1094">1094</a>         <strong class="jxr_keyword">for</strong> (<strong class="jxr_keyword">int</strong> index = 0; iterator.hasNext(); index++) {
<a class="jxr_linenumber" name="L1095" href="#L1095">1095</a>             HeaderCard card = iterator.next();
<a class="jxr_linenumber" name="L1096" href="#L1096">1096</a>             <strong class="jxr_keyword">if</strong> (card.getKey().equals(<span class="jxr_string">"VOTMETA"</span>)) {
<a class="jxr_linenumber" name="L1097" href="#L1097">1097</a>                 votMetaIndex = index;
<a class="jxr_linenumber" name="L1098" href="#L1098">1098</a>             }
<a class="jxr_linenumber" name="L1099" href="#L1099">1099</a>             <strong class="jxr_keyword">if</strong> (card.getKey().equals(<span class="jxr_string">"EXTEND"</span>)) {
<a class="jxr_linenumber" name="L1100" href="#L1100">1100</a>                 extendIndex = index;
<a class="jxr_linenumber" name="L1101" href="#L1101">1101</a>             }
<a class="jxr_linenumber" name="L1102" href="#L1102">1102</a>         }
<a class="jxr_linenumber" name="L1103" href="#L1103">1103</a>         Assert.assertTrue(votMetaIndex &lt; extendIndex);
<a class="jxr_linenumber" name="L1104" href="#L1104">1104</a> 
<a class="jxr_linenumber" name="L1105" href="#L1105">1105</a>     }
<a class="jxr_linenumber" name="L1106" href="#L1106">1106</a> }
</pre>
<hr/>
<div id="footer">Copyright &#169; 1996&#x2013;2017 nom-tam-fits. All rights reserved.</div>
</body>
</html>
